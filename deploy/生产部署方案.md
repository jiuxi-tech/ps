# 党校业务中台 生产部署文档（CentOS · IP: 192.168.0.139）

> **适用环境**：CentOS 服务器  
> **服务器 IP**：`192.168.0.139`  
> **部署目录**：`/root/jiuxi/lab/ps`  
> **文件要求**：`ps-be.jar`（后端）、`dist.zip`（前端）

---

## 📁 一、最终目录结构

```bash
/root/jiuxi/lab/ps/
│
├── ps-be.jar                 # 后端程序
├── application.yml           # 主配置（通用）
├── application-prod.yml      # 生产配置（覆盖）
├── ps.log                    # 后端日志
│
├── dist/                     # 前端静态资源（由 dist.zip 解压）
│   ├── index.html
│   └── static/
│
└── restart.sh                # 一键重启脚本
```

---

## 🔧 二、部署步骤

### 1. 上传并解压前端
```bash
cd /root/jiuxi/lab/ps
unzip dist.zip  # 确保生成 dist/ 目录
```

### 2. 创建配置文件

#### 主配置（通用）
略

#### 生产配置（请按实际修改数据库信息！）
略

> 🔐 **设置数据库密码（临时）**：
> ```bash
> export DB_PASS="你的真实数据库密码"
> ```

### 3. 启动后端
```bash
cd /root/jiuxi/lab/ps
nohup java -jar ps-be.jar --spring.profiles.active=prod > ps.log 2>&1 &
```

---

## 🌐 三、配置 Nginx

### 1. 创建站点配置（自动适配你的 IP）
将 `ps.conf` 放到 `/etc/nginx/conf.d/` 下。

### 2. 重载 Nginx
```bash
sudo nginx -t && sudo systemctl reload nginx
```
 
---

## 🔄 四、一键重启脚本

### 1. 创建脚本（含你的密码占位）
```bash
cat > restart.sh <<'EOF'
#!/bin/bash
cd /root/jiuxi/lab/ps

# 🔐 请修改为真实密码！
export DB_PASS="你的真实数据库密码"

# 停止旧进程
pkill -f ps-be.jar 2>/dev/null
sleep 2

# 启动新进程
nohup java -jar ps-be.jar --spring.profiles.active=prod > ps.log 2>&1 &
echo "✅ 应用已重启！访问 http://192.168.0.139"
EOF
```

### 2. 赋予权限
```bash
chmod +x restart.sh
```

### 3. 使用
```bash
./restart.sh  # 更新配置或 JAR 后运行此命令
```

---

## ✅ 五、验证访问

- **前端页面**：浏览器打开 → [http://192.168.0.139](http://192.168.0.139)  
- **后端接口**：测试命令 →  
  ```bash
  curl http://192.168.0.139/api/health
  ```

---

## 📝 六、常用命令

| 操作 | 命令 |
|------|------|
| 查看后端日志 | `tail -f /root/jiuxi/lab/ps/ps.log` |
| 查看 Nginx 错误 | `tail -f /var/log/nginx/error.log` |
| 重载 Nginx | `sudo nginx -s reload` |
| 查看 Java 进程 | `ps aux | grep ps-be.jar` |

---

> 💡 **部署完成！现在可通过 `http://192.168.0.139` 访问你的应用。**  
> 后续更新：改配置 → `./restart.sh`，换前端 → 重新解压 `dist.zip`。
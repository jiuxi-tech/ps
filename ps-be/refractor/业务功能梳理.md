# PS-BE Module模块业务功能详细梳理

## 文档说明

本文档详细梳理了`D:\keycloak_sb_sso_new0910\ps\ps-be\src\main\java\com\jiuxi\module`目录下各模块的业务功能、接口定义、参数类型和返回值，为模块重构提供准确的功能参照，确保重构过程中不偏离原有业务逻辑。

## 模块概览

当前系统包含以下主要业务模块：

```
module/
├── auth/           # 权限认证模块（菜单、角色、权限管理）
├── authorization/  # 权限授权模块（重复模块，待整合）
├── integration/    # 第三方集成模块（Keycloak集成）
├── org/           # 组织架构模块（部门管理）
├── organization/  # 组织管理模块（重复模块，待整合）
├── sys/           # 系统管理模块（配置、字典）
├── system/        # 系统配置模块（重复模块，待整合）
├── test/          # 测试模块
└── user/          # 用户管理模块
```

---

## 一、用户管理模块（user）

### 模块概述
用户管理模块采用DDD架构设计，负责用户信息、用户账户、用户档案的完整生命周期管理，包括创建、更新、查询、删除和状态管理。

### 1.1 核心实体结构

#### User（用户聚合根）
```java
// 核心属性
private String personId;           // 用户ID（主键）
private String deptId;            // 部门ID
private UserProfile profile;      // 用户档案
private UserAccount account;      // 用户账户
private ContactInfo contactInfo; // 联系信息
private UserStatus status;       // 用户状态
private UserCategory category;   // 用户类别
```

#### UserProfile（用户档案值对象）
```java
private String personName;        // 用户姓名
private String personNo;         // 用户编号
private Integer sex;             // 性别
private String idType;           // 证件类型
private String idCard;           // 证件号码
private String nativePlace;     // 籍贯
private String nation;           // 民族
private String birthday;         // 生日
private String profilePhoto;     // 头像
```

### 1.2 REST API接口详情

#### 1.2.1 用户信息获取接口

**获取当前用户信息**
- **接口路径**: `GET /api/v1/users/me`
- **功能描述**: 登录成功后获取当前用户的详细信息
- **请求头参数**:
  ```
  X-User-Dept-Id: String (可选) - JWT中的部门ID
  X-User-Person-Id: String (可选) - JWT中的用户ID  
  X-User-Role-Ids: String (可选) - JWT中的角色ID列表
  X-User-City-Code: String (可选) - JWT中的城市代码
  ```
- **返回类型**: `JsonResponse<PersonVO>`
- **业务逻辑**: 
  1. 从JWT头部获取用户基础信息
  2. 调用PersonService获取用户详细信息
  3. 补充角色和城市信息
  4. 返回完整的用户信息对象

**查看用户详情**
- **接口路径**: `GET /api/v1/users/{personId}`
- **功能描述**: 根据用户ID获取用户详细信息
- **路径参数**: 
  - `personId: String` - 用户ID
- **返回类型**: `JsonResponse<UserResponseDTO>`
- **权限控制**: 需要用户ID权限验证
- **业务逻辑**:
  1. 参数验证：检查personId是否存在
  2. 调用UserApplicationService.getUserById()
  3. 返回用户详细信息或错误信息

**根据用户名查询用户**
- **接口路径**: `GET /api/v1/users/username/{username}`
- **功能描述**: 根据用户名获取用户信息
- **路径参数**: 
  - `username: String` - 用户名
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<UserResponseDTO>`
- **业务逻辑**:
  1. 验证租户ID和用户名
  2. 调用UserApplicationService.getUserByUsername()
  3. 返回匹配的用户信息

#### 1.2.2 用户管理接口

**创建用户**
- **接口路径**: `POST /api/v1/users`
- **功能描述**: 创建新用户，包括用户信息和账户信息
- **请求体**: `UserCreateDTO`
  ```java
  {
    "deptId": "String",              // 部门ID（必填）
    "personName": "String",          // 用户姓名（必填，最大50字符）
    "phone": "String",               // 手机号（符合手机号格式）
    "email": "String",               // 邮箱地址（符合邮箱格式）
    "tel": "String",                 // 固定电话（可选）
    "personNo": "String",            // 用户编号（可选，系统自动生成）
    "sex": "Integer",                // 性别（可选）
    "idType": "String",              // 证件类型（可选）
    "idCard": "String",              // 证件号码（可选，符合身份证格式）
    "nativePlace": "String",         // 籍贯（可选）
    "nation": "String",              // 民族（可选）
    "resume": "String",              // 个人简历（可选）
    "birthday": "String",            // 生日（可选）
    "office": "String",              // 办公室（可选）
    "profilePhoto": "String",        // 头像URL（可选）
    "category": "String",            // 用户类别（可选）
    "username": "String",            // 用户名（必填，3-20字符，字母数字下划线中文）
    "password": "String"             // 密码（必填，6-20字符，包含大小写字母和数字）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 返回新创建用户的personId
- **验证规则**:
  - 姓名长度不超过50字符
  - 手机号格式验证
  - 邮箱格式验证
  - 身份证号格式验证（可选）
  - 用户名唯一性验证
  - 密码强度验证
- **业务逻辑**:
  1. 数据验证：字段格式、必填项、长度限制
  2. 业务验证：用户名唯一性、邮箱唯一性、部门存在性
  3. 生成用户ID和用户编号
  4. 创建用户档案和账户信息
  5. 保存到数据库
  6. 发布用户创建事件

**更新用户信息**
- **接口路径**: `PUT /api/v1/users/{personId}`
- **功能描述**: 更新用户的基本信息和档案信息
- **路径参数**: 
  - `personId: String` - 用户ID
- **请求体**: `UserUpdateDTO`
  ```java
  {
    "personName": "String",          // 用户姓名（可选更新）
    "phone": "String",               // 手机号（可选更新）
    "email": "String",               // 邮箱地址（可选更新）
    "tel": "String",                 // 固定电话（可选更新）
    "sex": "Integer",                // 性别（可选更新）
    "idType": "String",              // 证件类型（可选更新）
    "idCard": "String",              // 证件号码（可选更新）
    "nativePlace": "String",         // 籍贯（可选更新）
    "nation": "String",              // 民族（可选更新）
    "resume": "String",              // 个人简历（可选更新）
    "birthday": "String",            // 生日（可选更新）
    "office": "String",              // 办公室（可选更新）
    "profilePhoto": "String",        // 头像URL（可选更新）
    "category": "String"             // 用户类别（可选更新）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 更新成功消息
- **权限控制**: 需要用户ID权限验证
- **业务逻辑**:
  1. 验证用户存在性
  2. 检查更新权限
  3. 验证更新数据格式
  4. 执行字段更新
  5. 保存变更
  6. 发布用户更新事件

#### 1.2.3 用户状态管理接口

**激活用户**
- **接口路径**: `PUT /api/v1/users/{personId}/activate`
- **功能描述**: 激活指定用户账户
- **路径参数**: 
  - `personId: String` - 用户ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 操作结果消息
- **权限控制**: 需要用户ID权限验证
- **业务逻辑**:
  1. 验证用户存在性
  2. 检查当前用户状态
  3. 执行激活操作
  4. 更新账户状态
  5. 记录操作日志

**停用用户**
- **接口路径**: `PUT /api/v1/users/{personId}/deactivate`
- **功能描述**: 停用指定用户账户
- **路径参数**: 
  - `personId: String` - 用户ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 操作结果消息
- **权限控制**: 需要用户ID权限验证
- **业务逻辑**:
  1. 验证用户存在性
  2. 检查是否可以停用（如管理员账户保护）
  3. 执行停用操作
  4. 更新账户状态
  5. 清理用户会话
  6. 记录操作日志

#### 1.2.4 用户查询接口

**根据部门查询用户列表**
- **接口路径**: `GET /api/v1/users/departments/{deptId}`
- **功能描述**: 获取指定部门下的所有用户
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<List<UserResponseDTO>>`
- **业务逻辑**:
  1. 验证部门ID存在性
  2. 查询部门下所有用户
  3. 返回用户列表信息

**分页查询用户列表**
- **接口路径**: `POST /api/v1/users/search`
- **功能描述**: 根据条件分页查询用户列表
- **请求体**: `UserQueryDTO`
  ```java
  {
    "tenantId": "String",            // 租户ID
    "deptId": "String",              // 部门ID（可选筛选）
    "personName": "String",          // 用户姓名（模糊查询）
    "phone": "String",               // 手机号（模糊查询）
    "username": "String",            // 用户名（模糊查询）
    "sex": "Integer",                // 性别（精确匹配）
    "category": "String",            // 用户类别（精确匹配）
    "status": "String",              // 用户状态（精确匹配）
    "current": "Integer",            // 当前页码（默认1）
    "size": "Integer"                // 页面大小（默认10）
  }
  ```
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<PageResult<UserResponseDTO>>`
  ```java
  {
    "data": [UserResponseDTO],       // 用户列表数据
    "total": "Long",                 // 总记录数
    "current": "Integer",            // 当前页码
    "size": "Integer",               // 页面大小
    "pages": "Long"                  // 总页数
  }
  ```
- **业务逻辑**:
  1. 参数验证和设置默认值
  2. 构建查询条件
  3. 执行分页查询
  4. 统计总记录数
  5. 组装分页结果

#### 1.2.5 用户删除接口

**删除用户**
- **接口路径**: `DELETE /api/v1/users/{personId}`
- **功能描述**: 删除指定用户（软删除）
- **路径参数**: 
  - `personId: String` - 用户ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 删除结果消息
- **权限控制**: 需要用户ID权限验证
- **业务逻辑**:
  1. 验证用户存在性
  2. 检查删除权限（不能删除自己、超级管理员等）
  3. 检查用户是否有关联数据
  4. 执行软删除
  5. 清理相关缓存
  6. 发布用户删除事件

**批量删除用户**
- **接口路径**: `DELETE /api/v1/users/batch`
- **功能描述**: 批量删除多个用户
- **请求体**: `List<String>` - 用户ID列表
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 批量删除结果消息
- **业务逻辑**:
  1. 验证用户ID列表
  2. 逐个检查删除权限
  3. 执行批量删除操作
  4. 记录操作结果
  5. 发布批量删除事件

### 1.3 数据传输对象（DTO）详情

#### UserResponseDTO（用户响应DTO）
```java
{
  // 基本信息
  "personId": "String",              // 用户ID
  "personName": "String",            // 用户姓名
  "profilePhoto": "String",          // 头像URL
  "personNo": "String",              // 用户编号
  "sex": "Integer",                  // 性别代码
  "sexName": "String",               // 性别名称
  "idType": "String",                // 证件类型
  "idCard": "String",                // 证件号码
  "nativePlace": "String",           // 籍贯
  "nation": "String",                // 民族
  "resume": "String",                // 个人简历
  "birthday": "String",              // 生日
  "phone": "String",                 // 手机号
  "email": "String",                 // 邮箱
  "tel": "String",                   // 固定电话
  "office": "String",                // 办公室
  "category": "String",              // 用户类别代码
  "categoryName": "String",          // 用户类别名称
  "status": "String",                // 用户状态代码
  "statusName": "String",            // 用户状态名称
  
  // 账户信息
  "accountId": "String",             // 账户ID
  "username": "String",              // 用户名
  "accountLocked": "Boolean",        // 账户是否锁定
  "accountEnabled": "Boolean",       // 账户是否启用
  "expiredTime": "LocalDateTime",    // 账户过期时间
  "keycloakId": "String",           // Keycloak用户ID
  
  // 部门信息
  "deptId": "String",               // 部门ID
  "deptName": "String",             // 部门名称
  "deptFullName": "String",         // 部门全称
  
  // 审计信息
  "creator": "String",              // 创建者
  "createTime": "LocalDateTime",    // 创建时间
  "updator": "String",              // 更新者
  "updateTime": "LocalDateTime"     // 更新时间
}
```

---

## 二、权限认证模块（auth）

### 模块概述
权限认证模块实现了基于RBAC（Role-Based Access Control）的权限管理体系，包含菜单资源管理、角色管理、权限管理和数据权限控制等核心功能。

### 2.1 核心实体结构

#### Menu（菜单实体）
```java
private String menuId;            // 菜单ID
private String menuCode;          // 菜单编码
private String menuName;          // 菜单名称
private String menuTitle;         // 菜单标题
private String parentMenuId;      // 父菜单ID
private String menuPath;          // 菜单路径
private Integer menuLevel;        // 菜单层级
private MenuType menuType;        // 菜单类型（目录/菜单/按钮）
private String menuUri;           // 菜单URI
private String menuIcon;          // 菜单图标
private String component;         // 组件路径
private MenuStatus status;        // 菜单状态
private Boolean visible;          // 是否显示
private Boolean keepAlive;        // 是否缓存
private Boolean external;         // 是否外链
private Boolean leaf;             // 是否叶子节点
private List<Menu> children;      // 子菜单列表
private Integer orderIndex;       // 排序序号
```

#### Role（角色实体）
```java
private String roleId;            // 角色ID
private String roleCode;          // 角色编码
private String roleName;          // 角色名称
private String roleDesc;          // 角色描述
private RoleType roleType;        // 角色类型
private RoleStatus status;        // 角色状态
private List<Permission> permissions; // 权限列表
private List<DataPermission> dataPermissions; // 数据权限列表
```

#### Permission（权限实体）
```java
private String permissionId;      // 权限ID
private String permissionCode;    // 权限编码
private String permissionName;    // 权限名称
private PermissionType type;      // 权限类型
private String resourcePath;      // 资源路径
private PermissionStatus status;  // 权限状态
```

### 2.2 REST API接口详情

#### 2.2.1 菜单管理接口

**创建菜单**
- **接口路径**: `POST /api/v1/menus`
- **功能描述**: 创建新的菜单项
- **请求体**: `MenuCreateDTO`
  ```java
  {
    "menuCode": "String",            // 菜单编码（必填，唯一）
    "menuName": "String",            // 菜单名称（必填）
    "menuTitle": "String",           // 菜单标题（可选）
    "parentMenuId": "String",        // 父菜单ID（可选）
    "menuType": "MenuType"           // 菜单类型（DIRECTORY/MENU/BUTTON）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 返回新创建菜单的menuId
- **业务逻辑**:
  1. 验证菜单编码唯一性
  2. 验证父菜单存在性（如果指定）
  3. 计算菜单层级
  4. 创建菜单实体
  5. 保存菜单信息
  6. 发布菜单创建事件

**更新菜单信息**
- **接口路径**: `PUT /api/v1/menus/{menuId}`
- **功能描述**: 更新菜单的基本信息
- **路径参数**: 
  - `menuId: String` - 菜单ID
- **请求体**: `MenuUpdateDTO`
  ```java
  {
    "menuName": "String",            // 菜单名称（可选更新）
    "menuTitle": "String",           // 菜单标题（可选更新）
    "menuPath": "String",            // 菜单路径（可选更新）
    "menuUri": "String",             // 菜单URI（可选更新）
    "menuIcon": "String",            // 菜单图标（可选更新）
    "component": "String",           // 组件路径（可选更新）
    "visible": "Boolean",            // 是否显示（可选更新）
    "keepAlive": "Boolean",          // 是否缓存（可选更新）
    "external": "Boolean",           // 是否外链（可选更新）
    "orderIndex": "Integer"          // 排序序号（可选更新）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 更新结果消息

**删除菜单**
- **接口路径**: `DELETE /api/v1/menus/{menuId}`
- **功能描述**: 删除指定菜单（级联删除子菜单）
- **路径参数**: 
  - `menuId: String` - 菜单ID
- **返回类型**: `JsonResponse<String>` - 删除结果消息
- **业务逻辑**:
  1. 验证菜单存在性
  2. 检查是否有子菜单
  3. 检查是否有角色绑定
  4. 执行级联删除
  5. 清理相关权限缓存

**移动菜单**
- **接口路径**: `PUT /api/v1/menus/{menuId}/move`
- **功能描述**: 将菜单移动到新的父菜单下
- **路径参数**: 
  - `menuId: String` - 菜单ID
- **请求参数**: 
  - `newParentId: String` - 新父菜单ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 移动结果消息
- **业务逻辑**:
  1. 验证菜单和目标父菜单存在性
  2. 检查是否形成循环依赖
  3. 重新计算菜单层级
  4. 更新菜单位置
  5. 刷新菜单树结构

**启用/停用菜单**
- **接口路径**: 
  - `PUT /api/v1/menus/{menuId}/enable` - 启用菜单
  - `PUT /api/v1/menus/{menuId}/disable` - 停用菜单
- **功能描述**: 修改菜单的启用状态
- **路径参数**: 
  - `menuId: String` - 菜单ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 操作结果消息
- **业务逻辑**:
  1. 验证菜单存在性
  2. 更新菜单状态
  3. 影响子菜单状态（可选）
  4. 刷新权限缓存

#### 2.2.2 角色管理接口

**创建角色**
- **接口路径**: `POST /api/v1/roles`
- **功能描述**: 创建新的角色
- **请求体**: `RoleCreateDTO`
  ```java
  {
    "roleCode": "String",            // 角色编码（必填，唯一）
    "roleName": "String",            // 角色名称（必填）
    "roleDesc": "String",            // 角色描述（可选）
    "roleType": "RoleType"           // 角色类型（SYSTEM/BUSINESS/CUSTOM）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 返回新创建角色的roleId

**分配权限给角色**
- **接口路径**: `POST /api/v1/roles/{roleId}/permissions`
- **功能描述**: 为角色分配菜单权限和操作权限
- **路径参数**: 
  - `roleId: String` - 角色ID
- **请求体**: `RolePermissionAssignDTO`
  ```java
  {
    "permissionIds": ["String"],     // 权限ID列表
    "menuIds": ["String"],           // 菜单ID列表
    "dataPermissions": [             // 数据权限列表
      {
        "scope": "DataScope",        // 数据范围（ALL/DEPT/SELF等）
        "scopeValue": "String"       // 范围值（部门ID等）
      }
    ]
  }
  ```
- **返回类型**: `JsonResponse<String>` - 分配结果消息

**查询角色权限**
- **接口路径**: `GET /api/v1/roles/{roleId}/permissions`
- **功能描述**: 获取角色的所有权限信息
- **路径参数**: 
  - `roleId: String` - 角色ID
- **返回类型**: `JsonResponse<RolePermissionResponseDTO>`
  ```java
  {
    "roleInfo": {                    // 角色基本信息
      "roleId": "String",
      "roleCode": "String",
      "roleName": "String",
      "roleDesc": "String",
      "roleType": "RoleType"
    },
    "permissions": [                 // 操作权限列表
      {
        "permissionId": "String",
        "permissionCode": "String",
        "permissionName": "String",
        "resourcePath": "String"
      }
    ],
    "menus": [                       // 菜单权限列表（树形结构）
      {
        "menuId": "String",
        "menuCode": "String", 
        "menuName": "String",
        "menuPath": "String",
        "children": [...]
      }
    ],
    "dataPermissions": [             // 数据权限列表
      {
        "scope": "DataScope",
        "scopeValue": "String",
        "description": "String"
      }
    ]
  }
  ```

#### 2.2.3 权限验证接口

**检查用户权限**
- **接口路径**: `POST /api/v1/auth/check-permission`
- **功能描述**: 检查用户是否具有指定的权限
- **请求体**: `PermissionCheckDTO`
  ```java
  {
    "userId": "String",              // 用户ID
    "permissionCode": "String",      // 权限编码
    "resourcePath": "String",        // 资源路径（可选）
    "action": "String"               // 操作类型（READ/WRITE/DELETE等）
  }
  ```
- **返回类型**: `JsonResponse<PermissionCheckResult>`
  ```java
  {
    "hasPermission": "Boolean",      // 是否有权限
    "reason": "String",              // 权限说明或拒绝原因
    "effectiveRoles": ["String"],    // 生效的角色列表
    "dataScope": "DataScope"         // 数据访问范围
  }
  ```

**获取用户菜单树**
- **接口路径**: `GET /api/v1/auth/user-menus`
- **功能描述**: 获取当前用户有权限访问的菜单树
- **请求头参数**:
  - `X-User-Person-Id: String` - 用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<MenuTreeDTO>>`
  ```java
  [
    {
      "menuId": "String",
      "menuCode": "String",
      "menuName": "String",
      "menuTitle": "String",
      "menuPath": "String",
      "menuIcon": "String",
      "component": "String",
      "menuType": "MenuType",
      "visible": "Boolean",
      "external": "Boolean",
      "keepAlive": "Boolean",
      "orderIndex": "Integer",
      "children": [...]              // 递归子菜单结构
    }
  ]
  ```

---

## 三、组织架构模块（org）

### 模块概述
组织架构模块负责企业组织结构的管理，包括部门的层级关系、部门信息维护、组织架构查询和统计分析等功能，支持无限层级的部门树结构。

### 3.1 核心实体结构

#### Department（部门实体）
```java
private String deptId;            // 部门ID
private String deptName;          // 部门名称
private String deptSimpleName;    // 部门简称
private String deptFullName;      // 部门全称
private String parentDeptId;      // 父部门ID
private Integer deptLevel;        // 部门层级
private DepartmentType type;      // 部门类型
private String managerId;         // 部门负责人ID
private String contactPhone;      // 联系电话
private String address;           // 联系地址
private String description;       // 部门描述
private DepartmentStatus status;  // 部门状态
private Integer orderIndex;       // 排序序号
private Integer leftValue;        // 左值（嵌套集合模型）
private Integer rightValue;       // 右值（嵌套集合模型）
```

#### Enterprise（企业实体）
```java
private String enterpriseId;      // 企业ID
private String enterpriseName;    // 企业名称
private String enterpriseCode;    // 企业编码
private String legalRepresentative; // 法定代表人
private String businessLicense;   // 营业执照号
private EnterpriseStatus status;  // 企业状态
```

### 3.2 REST API接口详情

#### 3.2.1 部门基础管理接口

**创建部门**
- **接口路径**: `POST /api/v1/departments`
- **功能描述**: 创建新的部门
- **请求体**: `DepartmentCreateDTO`
  ```java
  {
    "deptName": "String",            // 部门名称（必填，最大100字符）
    "deptSimpleName": "String",      // 部门简称（可选，最大50字符）
    "deptFullName": "String",        // 部门全称（可选，最大200字符）
    "parentDeptId": "String",        // 父部门ID（可选）
    "type": "DepartmentType",        // 部门类型（BUSINESS/FUNCTIONAL/VIRTUAL）
    "managerId": "String",           // 部门负责人ID（可选）
    "contactPhone": "String",        // 联系电话（可选，最大20字符）
    "address": "String",             // 联系地址（可选，最大200字符）
    "description": "String",         // 部门描述（可选，最大500字符）
    "orderIndex": "Integer"          // 排序序号（可选）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<DepartmentResponseDTO>`
- **业务逻辑**:
  1. 验证部门名称在同级别下的唯一性
  2. 验证父部门存在性（如果指定）
  3. 计算部门层级和左右值
  4. 创建部门实体
  5. 更新父部门的子部门计数
  6. 发布部门创建事件

**更新部门信息**
- **接口路径**: `PUT /api/v1/departments/{deptId}`
- **功能描述**: 更新部门的基本信息
- **路径参数**: 
  - `deptId: String` - 部门ID
- **请求体**: `DepartmentUpdateDTO`
  ```java
  {
    "deptName": "String",            // 部门名称（可选更新）
    "deptSimpleName": "String",      // 部门简称（可选更新）
    "deptFullName": "String",        // 部门全称（可选更新）
    "managerId": "String",           // 部门负责人ID（可选更新）
    "contactPhone": "String",        // 联系电话（可选更新）
    "address": "String",             // 联系地址（可选更新）
    "description": "String",         // 部门描述（可选更新）
    "orderIndex": "Integer"          // 排序序号（可选更新）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<DepartmentResponseDTO>`
- **权限控制**: 需要部门ID权限验证

**查看部门详情**
- **接口路径**: `GET /api/v1/departments/{deptId}`
- **功能描述**: 获取部门的详细信息
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<DepartmentResponseDTO>`
  ```java
  {
    "deptId": "String",              // 部门ID
    "deptName": "String",            // 部门名称
    "deptSimpleName": "String",      // 部门简称
    "deptFullName": "String",        // 部门全称
    "parentDeptId": "String",        // 父部门ID
    "deptLevel": "Integer",          // 部门层级
    "type": "DepartmentType",        // 部门类型
    "typeName": "String",            // 部门类型名称
    "managerId": "String",           // 部门负责人ID
    "managerName": "String",         // 部门负责人姓名
    "contactPhone": "String",        // 联系电话
    "address": "String",             // 联系地址
    "description": "String",         // 部门描述
    "status": "DepartmentStatus",    // 部门状态
    "statusName": "String",          // 部门状态名称
    "orderIndex": "Integer",         // 排序序号
    "userCount": "Long",             // 部门用户数量
    "childrenCount": "Long",         // 直接子部门数量
    "creator": "String",             // 创建者
    "createTime": "LocalDateTime",   // 创建时间
    "updator": "String",             // 更新者
    "updateTime": "LocalDateTime"    // 更新时间
  }
  ```
- **权限控制**: 需要部门ID权限验证

#### 3.2.2 部门树形查询接口

**获取部门树形结构**
- **接口路径**: `GET /api/v1/departments/tree`
- **功能描述**: 获取完整的部门树形结构
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>` - 树形结构的部门列表
- **业务逻辑**:
  1. 查询租户下所有激活部门
  2. 构建部门树形结构
  3. 按层级和排序序号排序
  4. 返回完整树形数据

**根据父部门查询子部门列表**
- **接口路径**: `GET /api/v1/departments/parent/{parentDeptId}`
- **功能描述**: 获取指定父部门的直接子部门
- **路径参数**: 
  - `parentDeptId: String` - 父部门ID
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`

**获取根部门列表**
- **接口路径**: `GET /api/v1/departments/root`
- **功能描述**: 获取所有根级部门（没有父部门的部门）
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`

#### 3.2.3 部门高级查询接口

**查询部门的祖先链**
- **接口路径**: `GET /api/v1/departments/{deptId}/ancestors`
- **功能描述**: 获取指定部门的所有祖先部门，从根部门到直接父部门
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`
- **权限控制**: 需要部门ID权限验证
- **业务逻辑**:
  1. 从指定部门开始向上查找
  2. 递归查询所有祖先部门
  3. 按层级从高到低排序
  4. 返回祖先链列表

**查询部门的完整子树**
- **接口路径**: `GET /api/v1/departments/{deptId}/descendants`
- **功能描述**: 获取指定部门的所有后代部门（完整子树）
- **路径参数**: 
  - `deptId: String` - 部门ID
- **请求参数**: 
  - `includeInactive: Boolean` - 是否包含停用部门（默认false）
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`
- **权限控制**: 需要部门ID权限验证

**按层级查询部门**
- **接口路径**: `GET /api/v1/departments/level/{level}`
- **功能描述**: 查询指定层级的所有部门
- **路径参数**: 
  - `level: Integer` - 部门层级（1表示根级部门）
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`

**嵌套集合查询（高效树形查询）**
- **接口路径**: `GET /api/v1/departments/nested-set`
- **功能描述**: 使用嵌套集合模型进行高效的树形查询
- **请求参数**: 
  - `leftValue: Integer` - 左值
  - `rightValue: Integer` - 右值
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`
- **业务逻辑**:
  1. 使用左右值进行范围查询
  2. 高效查找指定范围内的所有部门
  3. 适用于大量数据的树形查询

#### 3.2.4 部门操作接口

**删除部门**
- **接口路径**: `DELETE /api/v1/departments/{deptId}`
- **功能描述**: 删除指定部门（需确保无子部门和用户）
- **路径参数**: 
  - `deptId: String` - 部门ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 删除结果消息
- **权限控制**: 需要部门ID权限验证
- **业务逻辑**:
  1. 验证部门存在性
  2. 检查是否有子部门
  3. 检查是否有关联用户
  4. 执行删除操作
  5. 更新左右值编码
  6. 发布部门删除事件

**批量删除部门**
- **接口路径**: `DELETE /api/v1/departments/batch`
- **功能描述**: 批量删除多个部门
- **请求体**: `List<String>` - 部门ID列表
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 批量删除结果消息

**启用/停用部门**
- **接口路径**: 
  - `PUT /api/v1/departments/{deptId}/enable` - 启用部门
  - `PUT /api/v1/departments/{deptId}/disable` - 停用部门
- **功能描述**: 修改部门的启用状态
- **路径参数**: 
  - `deptId: String` - 部门ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<String>` - 操作结果消息
- **权限控制**: 需要部门ID权限验证

**移动部门到新的父部门**
- **接口路径**: `PUT /api/v1/departments/{deptId}/move`
- **功能描述**: 将部门移动到新的父部门下
- **路径参数**: 
  - `deptId: String` - 部门ID
- **请求参数**: 
  - `newParentDeptId: String` - 新父部门ID
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<DepartmentResponseDTO>` - 移动后的部门信息
- **权限控制**: 需要部门ID权限验证
- **业务逻辑**:
  1. 验证移动操作的合法性
  2. 检查是否形成循环依赖
  3. 重新计算部门层级
  4. 更新左右值编码
  5. 移动子树到新位置

#### 3.2.5 部门统计分析接口

**获取部门详细统计信息**
- **接口路径**: `GET /api/v1/departments/{deptId}/statistics`
- **功能描述**: 获取部门的详细统计信息，包括子部门数量、用户数量、层级信息等
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<DepartmentStatisticsDTO>`
  ```java
  {
    "deptId": "String",              // 部门ID
    "deptName": "String",            // 部门名称
    "directChildrenCount": "Long",   // 直接子部门数量
    "totalDescendantsCount": "Long", // 总后代部门数量
    "directUserCount": "Long",       // 直接用户数量
    "totalUserCount": "Long",        // 总用户数量（包含子部门）
    "deptLevel": "Integer",          // 部门层级
    "maxChildLevel": "Integer",      // 最大子部门层级
    "isLeaf": "Boolean",             // 是否叶子部门
    "parentPath": "String",          // 父部门路径
    "fullPath": "String"             // 完整部门路径
  }
  ```
- **权限控制**: 需要部门ID权限验证

**获取租户部门概览统计**
- **接口路径**: `GET /api/v1/departments/overview`
- **功能描述**: 获取租户下所有部门的概览统计
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<TenantDepartmentOverviewDTO>`
  ```java
  {
    "totalDepartments": "Long",      // 总部门数量
    "activeDepartments": "Long",     // 激活部门数量
    "inactiveDepartments": "Long",   // 停用部门数量
    "maxLevel": "Integer",           // 最大层级
    "rootDepartmentsCount": "Long",  // 根部门数量
    "levelDistribution": {           // 层级分布
      "1": "Long",                   // 第1层部门数量
      "2": "Long",                   // 第2层部门数量
      "...": "Long"
    },
    "typeDistribution": {            // 类型分布
      "BUSINESS": "Long",            // 业务部门数量
      "FUNCTIONAL": "Long",          // 职能部门数量
      "VIRTUAL": "Long"              // 虚拟部门数量
    }
  }
  ```

**获取部门层级分布统计**
- **接口路径**: `GET /api/v1/departments/level-distribution`
- **功能描述**: 统计各层级的部门数量分布
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<Map<Integer, Long>>` - 层级与数量的映射

**查询部门下的用户数量**
- **接口路径**: `GET /api/v1/departments/{deptId}/user-count`
- **功能描述**: 统计指定部门下的用户数量
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<Long>` - 用户数量
- **权限控制**: 需要部门ID权限验证

**统计直接子部门数量**
- **接口路径**: `GET /api/v1/departments/{deptId}/direct-children-count`
- **功能描述**: 统计直接子部门的数量
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<Long>` - 直接子部门数量
- **权限控制**: 需要部门ID权限验证

**统计所有后代部门数量**
- **接口路径**: `GET /api/v1/departments/{deptId}/all-descendants-count`
- **功能描述**: 统计所有后代部门的数量
- **路径参数**: 
  - `deptId: String` - 部门ID
- **返回类型**: `JsonResponse<Long>` - 所有后代部门数量
- **权限控制**: 需要部门ID权限验证

#### 3.2.6 部门验证和工具接口

**验证部门移动操作**
- **接口路径**: `POST /api/v1/departments/{deptId}/validate-move`
- **功能描述**: 验证部门移动操作是否合法
- **路径参数**: 
  - `deptId: String` - 部门ID
- **请求参数**: 
  - `targetParentId: String` - 目标父部门ID
- **返回类型**: `JsonResponse<DepartmentMoveValidationResult>`
  ```java
  {
    "valid": "Boolean",              // 是否可以移动
    "message": "String",             // 验证消息
    "reasons": ["String"],           // 不能移动的原因列表
    "affectedSubtreeSize": "Integer", // 影响的子树大小
    "newLevel": "Integer"            // 移动后的新层级
  }
  ```
- **权限控制**: 需要部门ID权限验证

**检查部门祖先关系**
- **接口路径**: `GET /api/v1/departments/{ancestorId}/is-ancestor-of/{descendantId}`
- **功能描述**: 检查两个部门之间是否存在祖先关系
- **路径参数**: 
  - `ancestorId: String` - 祖先部门ID
  - `descendantId: String` - 后代部门ID
- **返回类型**: `JsonResponse<Boolean>` - 是否存在祖先关系

**查询租户最大部门层级**
- **接口路径**: `GET /api/v1/departments/max-level`
- **功能描述**: 查询租户下部门的最大层级
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<Integer>` - 最大层级数

**批量查询部门及其子部门**
- **接口路径**: `POST /api/v1/departments/batch-with-children`
- **功能描述**: 批量查询多个部门的信息，可选择包含子部门
- **请求体**: `List<String>` - 部门ID列表
- **请求参数**: 
  - `includeDescendants: Boolean` - 是否包含所有后代（默认false，仅包含直接子部门）
- **返回类型**: `JsonResponse<List<DepartmentResponseDTO>>`

---

## 四、系统管理模块（sys）

### 模块概述
系统管理模块负责系统运行时的配置管理和基础数据维护，包括系统配置的热更新、字典数据管理、配置验证和缓存管理等功能。

### 4.1 核心实体结构

#### SystemConfig（系统配置实体）
```java
private String configId;          // 配置ID
private ConfigKey configKeyObj;   // 配置键值对象
private ConfigValue configValueObj; // 配置值对象
private String configKey;         // 配置键（兼容性字段）
private String configValue;       // 配置值（兼容性字段）
private String configName;        // 配置名称
private String configDesc;        // 配置描述
private ConfigType configTypeEnum; // 配置类型枚举
private ConfigStatus configStatusEnum; // 配置状态枚举
private String dataType;          // 数据类型
private String configGroup;       // 配置组
private Boolean isSystemLevel;    // 是否系统级配置
private Boolean isReadonly;       // 是否只读配置
```

#### Dictionary（字典实体）
```java
private String dictId;            // 字典ID
private String dictCode;          // 字典编码
private String dictName;          // 字典名称
private String dictDesc;          // 字典描述
private DictionaryStatus status;  // 字典状态
private List<DictionaryItem> items; // 字典项列表
```

#### DictionaryItem（字典项实体）
```java
private String itemId;            // 字典项ID
private String dictId;            // 所属字典ID
private String itemCode;          // 字典项编码
private String itemName;          // 字典项名称
private String itemValue;         // 字典项值
private Integer orderIndex;       // 排序序号
private Boolean isDefault;        // 是否默认值
```

### 4.2 REST API接口详情

#### 4.2.1 系统配置管理接口

**创建系统配置**
- **接口路径**: `POST /api/v1/sys/config`
- **功能描述**: 创建新的系统配置项
- **请求体**: `SystemConfigCreateDTO`
  ```java
  {
    "configKey": "String",           // 配置键（必填，格式如：system.database.url）
    "configValue": "String",         // 配置值（必填）
    "configName": "String",          // 配置名称（必填）
    "configDesc": "String",          // 配置描述（可选）
    "configType": "String",          // 配置类型（SYSTEM/BUSINESS/USER）
    "dataType": "String",            // 数据类型（STRING/NUMBER/BOOLEAN/JSON）
    "configGroup": "String",         // 配置组（可选）
    "isSystemLevel": "Boolean",      // 是否系统级配置（默认false）
    "isReadonly": "Boolean",         // 是否只读配置（默认false）
    "tenantId": "String"             // 租户ID
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<SystemConfigResponseDTO>`
- **业务逻辑**:
  1. 验证配置键格式和唯一性
  2. 验证配置值的数据类型
  3. 创建配置实体和值对象
  4. 保存配置信息
  5. 刷新配置缓存
  6. 发布配置创建事件

**更新系统配置**
- **接口路径**: `PUT /api/v1/sys/config/{configId}`
- **功能描述**: 更新系统配置的值和属性
- **路径参数**: 
  - `configId: String` - 配置ID
- **请求体**: `SystemConfigUpdateDTO`
  ```java
  {
    "configValue": "String",         // 配置值（可选更新）
    "configName": "String",          // 配置名称（可选更新）
    "configDesc": "String",          // 配置描述（可选更新）
    "dataType": "String",            // 数据类型（可选更新）
    "configGroup": "String",         // 配置组（可选更新）
    "status": "String"               // 配置状态（可选更新）
  }
  ```
- **请求头参数**:
  - `X-User-Person-Id: String` - 操作者用户ID
- **返回类型**: `JsonResponse<SystemConfigResponseDTO>`
- **业务逻辑**:
  1. 验证配置存在性和可编辑性
  2. 验证新配置值的格式
  3. 更新配置信息
  4. 触发热更新机制
  5. 清理相关缓存

**根据配置键获取配置**
- **接口路径**: `GET /api/v1/sys/config/key/{configKey}`
- **功能描述**: 根据配置键获取配置信息（支持缓存）
- **路径参数**: 
  - `configKey: String` - 配置键
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<SystemConfigResponseDTO>`

**获取类型安全的配置值**
- **接口路径**: `GET /api/v1/sys/config/typed-value/{configKey}`
- **功能描述**: 获取指定类型的配置值
- **路径参数**: 
  - `configKey: String` - 配置键
- **请求参数**: 
  - `valueType: String` - 值类型（string/integer/long/double/boolean）
  - `defaultValue: String` - 默认值（可选）
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<Object>` - 类型化的配置值

**根据配置类型获取配置列表**
- **接口路径**: `GET /api/v1/sys/config/type/{configType}`
- **功能描述**: 获取指定类型的所有配置
- **路径参数**: 
  - `configType: String` - 配置类型代码
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<SystemConfigResponseDTO>>`

**根据配置组获取配置列表**
- **接口路径**: `GET /api/v1/sys/config/group/{configGroup}`
- **功能描述**: 获取指定组的所有配置
- **路径参数**: 
  - `configGroup: String` - 配置组名称
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<List<SystemConfigResponseDTO>>`

#### 4.2.2 配置热更新接口

**手动热更新配置**
- **接口路径**: `POST /api/v1/sys/config/hot-reload/{configKey}`
- **功能描述**: 手动触发指定配置的热更新
- **路径参数**: 
  - `configKey: String` - 配置键
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<Boolean>` - 更新是否成功

**批量热更新配置**
- **接口路径**: `POST /api/v1/sys/config/batch-hot-reload`
- **功能描述**: 批量热更新多个配置
- **请求体**: `List<String>` - 配置键列表
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<Integer>` - 成功更新的配置数量

#### 4.2.3 配置缓存管理接口

**获取缓存统计信息**
- **接口路径**: `GET /api/v1/sys/config/cache/stats`
- **功能描述**: 获取配置缓存的统计信息
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<CacheStatsDTO>`
  ```java
  {
    "hitCount": "Long",              // 缓存命中次数
    "missCount": "Long",             // 缓存未命中次数
    "hitRate": "Double",             // 缓存命中率
    "evictionCount": "Long",         // 缓存淘汰次数
    "cacheSize": "Long",             // 当前缓存大小
    "maxCacheSize": "Long",          // 最大缓存大小
    "averageLoadTime": "Double"      // 平均加载时间（毫秒）
  }
  ```

**清理配置缓存**
- **接口路径**: `DELETE /api/v1/sys/config/cache`
- **功能描述**: 清理指定租户的所有配置缓存
- **请求头参数**:
  - `X-Tenant-Id: String` - 租户ID
- **返回类型**: `JsonResponse<String>` - 清理结果消息

#### 4.2.4 字典管理接口

**创建字典**
- **接口路径**: `POST /system/dictionary`
- **功能描述**: 创建新的字典
- **请求体**: `DictionaryCreateDTO`
  ```java
  {
    "dictCode": "String",            // 字典编码（必填，唯一）
    "dictName": "String",            // 字典名称（必填）
    "dictDesc": "String",            // 字典描述（可选）
    "status": "String",              // 字典状态（ACTIVE/INACTIVE）
    "items": [                       // 字典项列表（可选）
      {
        "itemCode": "String",        // 字典项编码
        "itemName": "String",        // 字典项名称
        "itemValue": "String",       // 字典项值
        "orderIndex": "Integer",     // 排序序号
        "isDefault": "Boolean"       // 是否默认值
      }
    ]
  }
  ```
- **返回类型**: `Map<String, Object>` - 创建结果
  ```java
  {
    "code": "Integer",               // 响应码（200成功，500失败）
    "message": "String",             // 响应消息
    "data": "DictionaryResponseDTO"  // 字典信息（成功时）
  }
  ```

**更新字典**
- **接口路径**: `PUT /system/dictionary`
- **功能描述**: 更新字典信息
- **请求体**: `DictionaryUpdateDTO`
  ```java
  {
    "dictId": "String",              // 字典ID（必填）
    "dictName": "String",            // 字典名称（可选更新）
    "dictDesc": "String",            // 字典描述（可选更新）
    "status": "String"               // 字典状态（可选更新）
  }
  ```
- **返回类型**: `Map<String, Object>` - 更新结果

**根据ID获取字典**
- **接口路径**: `GET /system/dictionary/{dictId}`
- **功能描述**: 根据字典ID获取字典详细信息
- **路径参数**: 
  - `dictId: String` - 字典ID
- **返回类型**: `Map<String, Object>` - 查询结果
  ```java
  {
    "code": "Integer",               // 响应码
    "message": "String",             // 响应消息
    "data": {                        // 字典信息
      "dictId": "String",
      "dictCode": "String",
      "dictName": "String",
      "dictDesc": "String",
      "status": "String",
      "items": [                     // 字典项列表
        {
          "itemId": "String",
          "itemCode": "String",
          "itemName": "String",
          "itemValue": "String",
          "orderIndex": "Integer",
          "isDefault": "Boolean"
        }
      ]
    }
  }
  ```

**根据编码获取字典**
- **接口路径**: `GET /system/dictionary/code/{dictCode}`
- **功能描述**: 根据字典编码获取字典信息
- **路径参数**: 
  - `dictCode: String` - 字典编码
- **请求参数**: 
  - `tenantId: String` - 租户ID（可选，默认"default"）
- **返回类型**: `Map<String, Object>` - 查询结果

**删除字典**
- **接口路径**: `DELETE /system/dictionary/{dictId}`
- **功能描述**: 删除指定字典
- **路径参数**: 
  - `dictId: String` - 字典ID
- **返回类型**: `Map<String, Object>` - 删除结果

#### 4.2.5 字典项管理接口

**创建字典项**
- **接口路径**: `POST /system/dictionary-item`
- **功能描述**: 为字典添加新的字典项
- **请求体**: `DictionaryItemCreateDTO`
  ```java
  {
    "dictId": "String",              // 所属字典ID（必填）
    "itemCode": "String",            // 字典项编码（必填）
    "itemName": "String",            // 字典项名称（必填）
    "itemValue": "String",           // 字典项值（必填）
    "orderIndex": "Integer",         // 排序序号（可选）
    "isDefault": "Boolean"           // 是否默认值（可选）
  }
  ```
- **返回类型**: `Map<String, Object>` - 创建结果

**更新字典项**
- **接口路径**: `PUT /system/dictionary-item`
- **功能描述**: 更新字典项信息
- **请求体**: `DictionaryItemUpdateDTO`
  ```java
  {
    "itemId": "String",              // 字典项ID（必填）
    "itemName": "String",            // 字典项名称（可选更新）
    "itemValue": "String",           // 字典项值（可选更新）
    "orderIndex": "Integer",         // 排序序号（可选更新）
    "isDefault": "Boolean"           // 是否默认值（可选更新）
  }
  ```
- **返回类型**: `Map<String, Object>` - 更新结果

**删除字典项**
- **接口路径**: `DELETE /system/dictionary-item/{itemId}`
- **功能描述**: 删除指定字典项
- **路径参数**: 
  - `itemId: String` - 字典项ID
- **返回类型**: `Map<String, Object>` - 删除结果

---

## 五、集成模块（integration）

### 模块概述
集成模块负责与第三方系统的集成，主要包括Keycloak身份认证系统的集成，提供用户同步、认证配置和SSO功能。

### 5.1 核心功能

#### KeycloakIntegrationService（Keycloak集成服务）
```java
// 主要功能
- 用户信息同步
- 角色权限同步  
- 身份认证配置
- SSO单点登录集成
```

### 5.2 REST API接口详情

**同步Keycloak用户**
- **接口路径**: `POST /api/v1/integration/keycloak/sync-users`
- **功能描述**: 从Keycloak同步用户信息到本地系统
- **请求体**: `KeycloakSyncRequest`
  ```java
  {
    "realm": "String",               // Keycloak Realm名称
    "syncMode": "String",            // 同步模式（FULL/INCREMENTAL）
    "lastSyncTime": "LocalDateTime", // 上次同步时间（增量同步时使用）
    "userFilter": {                  // 用户过滤条件（可选）
      "enabled": "Boolean",          // 是否启用
      "groups": ["String"]           // 用户组过滤
    }
  }
  ```
- **返回类型**: `JsonResponse<SyncResultDTO>`
  ```java
  {
    "syncId": "String",              // 同步任务ID
    "startTime": "LocalDateTime",    // 同步开始时间
    "endTime": "LocalDateTime",      // 同步结束时间
    "totalUsers": "Integer",         // 总用户数
    "successCount": "Integer",       // 成功同步数量
    "failureCount": "Integer",       // 失败同步数量
    "errors": ["String"]             // 错误信息列表
  }
  ```

---

## 六、重复模块分析

### 6.1 authorization模块（待整合到auth）

#### 主要功能重叠
- **RoleService**: 与auth模块的角色管理功能重叠
- **AuthorizationRoleController**: 与auth模块的RoleController功能类似

#### 特有功能
- 角色权限的特定业务逻辑
- 权限验证的特定实现

### 6.2 organization模块（待整合到org）

#### 主要功能重叠
- **OrganizationDepartmentService**: 与org模块的部门管理重叠
- **OrganizationEnterpriseService**: 企业管理功能

#### 特有功能
- 企业级别的组织管理
- 特定的组织架构业务逻辑

### 6.3 system模块（待整合到sys）

#### 主要功能重叠
- **SystemConfigApplicationService**: 与sys模块的配置管理重叠
- 使用旧的TpSystemConfig实体

#### 适配器模式实现
```java
// SystemConfigApplicationServiceImpl作为适配器
// 调用底层TpSystemConfigService
// 提供统一的配置管理接口
```

---

## 七、数据类型和验证规则总结

### 7.1 通用数据类型

#### 标识符类型
- **用户ID**: `String` - personId，UUID格式
- **部门ID**: `String` - deptId，UUID格式  
- **角色ID**: `String` - roleId，UUID格式
- **菜单ID**: `String` - menuId，UUID格式
- **租户ID**: `String` - tenantId，字符串标识

#### 审计字段
```java
private String creator;           // 创建者用户ID
private LocalDateTime createTime; // 创建时间
private String updator;           // 更新者用户ID  
private LocalDateTime updateTime; // 更新时间
```

#### 分页参数
```java
private Integer current = 1;      // 当前页码，默认1
private Integer size = 10;        // 页面大小，默认10
```

### 7.2 验证规则汇总

#### 用户相关验证
- **用户姓名**: 必填，最大50字符
- **手机号**: 符合手机号格式（@Phone注解）
- **邮箱**: 符合邮箱格式（@Email注解）
- **身份证**: 符合身份证格式（@IdCard注解，可选）
- **用户名**: 3-20字符，字母数字下划线中文
- **密码**: 6-20字符，包含大小写字母和数字

#### 部门相关验证
- **部门名称**: 必填，最大100字符
- **部门简称**: 可选，最大50字符
- **部门全称**: 可选，最大200字符
- **联系电话**: 可选，最大20字符
- **联系地址**: 可选，最大200字符
- **部门描述**: 可选，最大500字符

#### 配置相关验证
- **配置键**: 必填，格式如"system.database.url"
- **配置值**: 必填，根据数据类型验证
- **配置名称**: 必填，用于显示

---

## 八、重构指导原则

### 8.1 功能保持原则
1. **接口兼容性**: 所有现有API接口必须保持功能不变
2. **数据一致性**: 重构过程中数据格式和结构保持一致
3. **业务逻辑完整性**: 所有业务规则和验证逻辑必须保留
4. **权限控制**: 现有的权限验证和访问控制机制必须保持

### 8.2 架构改进方向
1. **统一DDD架构**: 所有模块采用一致的DDD分层架构
2. **消除重复模块**: 整合功能重叠的模块，建立清晰边界
3. **增强事件驱动**: 完善领域事件和集成事件机制
4. **优化缓存策略**: 建立统一的缓存管理机制

### 8.3 代码质量要求
1. **统一编码规范**: 建立一致的命名和编码标准
2. **完善异常处理**: 统一异常处理和错误响应机制  
3. **增强测试覆盖**: 确保关键业务逻辑有完整测试覆盖
4. **优化依赖管理**: 减少模块间的循环依赖和紧耦合

---

## 总结

本文档详细梳理了PS-BE项目module目录下各模块的业务功能、API接口、数据结构和业务逻辑。通过这份详细的功能参照，可以确保在重构过程中：

1. **准确把握现有功能**: 每个接口的参数、返回值、业务逻辑都有详细记录
2. **防止功能遗漏**: 完整的功能清单确保重构不会丢失任何业务功能
3. **保持接口一致**: 明确的API定义确保重构后接口保持兼容
4. **指导架构设计**: 清晰的模块边界和职责划分为重构提供指导

**重构核心目标**：
- 🎯 **功能完整**: 确保所有现有功能在重构后完整保留
- 🏗️ **架构统一**: 建立一致的DDD分层架构和编码规范
- 🔄 **模块优化**: 消除重复模块，建立清晰的职责边界
- 📈 **质量提升**: 通过重构提升代码质量和可维护性
# 单业务模块重构计划模板 - AI优化版

## 🎯 AI任务指令

**任务目标**：
1. 基于输入的参考资料和模块代码，生成具体模块的DDD重构计划文档。
2. 严格执行生成的重构计划文档的每一步。
3. 将重构计划的每阶段执行进度和结果同步到该重构计划文档中。

**执行要求**：
1. 仔细分析所有输入资料，准确理解模块的业务职责和技术现状
2. 将模板中的所有 `{{占位符}}` 替换为具体的模块信息
3. 基于实际代码结构和业务逻辑填充分析内容
4. 保持原有功能不变的前提下制定重构方案
5. 确保生成的计划具有可操作性和完整性

---

## 📋 输入参数规范

**必需输入**：
- `参考文档1`：模块细粒度的优化计划.md（整体规划参考）
- `模块路径`：具体模块的源码路径
- `模块名称`：要重构的模块名称

**输出格式和存储位置**：
1. 完整的单模块重构计划文档，存储在：`{{项目路径}}/refactor/1-plan/{{当前日期}}/{{模块名称}}`目录下
2. 完整的单模块重构计划文档，命名为：`{{模块名称}}-单业务模块重构计划.md`

---

## 📖 模板内容

# {{模块名称}}单业务模块重构计划

> **生成时间**：{{当前日期}}  
> **模块路径**：`{{模块完整路径}}`  
> **重构版本**：v1.0

## 1. 项目概述

基于对 `{{模块完整路径}}` 的深度分析，本计划旨在**不破坏现有功能**的前提下，通过系统性重构实现：

- **统一架构设计**：全面采用DDD（领域驱动设计）分层架构
- **优化代码组织**：完善目录结构和代码组织方式  
- **提升可维护性**：建立清晰的业务边界和依赖关系
- **增强功能特性**：{{根据模块特点填写具体目标}}
- **优化模块代码**: 识别模块坏气味代码并进行修改
- **清理删除文件（夹）**: 识别无用的代码、文件或者目录

## 2. 现状分析

### 2.1 当前模块结构

```
{{模块名称}}/
{{当前目录结构树形图}}
```

### 2.2 核心业务识别

**主要业务职责**：{{模块核心业务职责描述}}

**关键业务用例**：
{{从业务功能梳理文档中提取的核心用例列表}}

### 2.3 主要问题识别

{{基于代码分析和参考文档识别的具体问题列表}}

1. **{{问题分类1}}**
   - {{具体问题描述1}}
   - {{具体问题描述2}}

2. **{{问题分类2}}**
   - {{具体问题描述1}}
   - {{具体问题描述2}}

### 2.4 技术债务评估

**代码质量问题**：
- {{代码重复率、复杂度等具体指标}}
- {{命名规范、结构问题等}}

**架构问题**：
- {{依赖关系、分层问题等}}

## 3. 重构目标与架构设计

### 3.1 目标DDD架构

```
{{模块名称}}/
├── app/                    # 应用服务层
│   ├── assembler/         # 对象装配器
│   ├── dto/               # 数据传输对象
│   └── service/           # 应用服务
├── domain/                # 领域层
│   ├── entity/            # 实体
│   ├── event/             # 领域事件
│   ├── repo/              # 仓储接口
│   ├── service/           # 领域服务
│   └── vo/                # 值对象
├── infra/                 # 基础设施层
│   └── persistence/       # 持久化
│       ├── assembler/     # PO装配器
│       ├── entity/        # 持久化对象
│       ├── mapper/        # MyBatis映射器
│       └── repo/          # 仓储实现
└── intf/                  # 接口层
    └── web/               # Web接口
        ├── controller/    # 控制器
        └── dto/           # 接口DTO
```

### 3.2 领域模型设计

**聚合根识别**：
{{基于业务分析识别的聚合根和边界}}

**领域事件定义**：
{{基于业务流程识别的关键事件}}

## 4. 重构实施计划

### 阶段一：准备与分析（第1周）

**4.1.1 业务接口档案建立**
- 扫描现有Web接口，记录所有API的URL、参数、返回值
- 生成文档内容主体是中文
- 生成接口业务说明文档：`{{项目路径}}/refactor/5-info/{{当前日期}}/{{模块名称}}/{{模块名称}}-test-api.md`，包括接口入参、返回类型，接口作用。文件名字要严格匹配，且该目录只生成这一个文件。
- 生成接口测试文档：`{{项目路径}}/refactor/2-test/{{当前日期}}/{{模块名称}}/{{模块名称}}-test-api.md`。文件名字要严格匹配，且该目录只生成这一个文件。文档内容主体是中文，包括接口测试用例、测试步骤。
- 生成接口测试脚本：文件前缀为 `{{项目路径}}/refactor/3-script/{{当前日期}}/{{模块名称}}/{{模块名称}}-test-api`。文件名字要严格匹配，且该目录只生成这一个文件。文件内容主体是中文，根据接口测试文档，生成接口测试脚本。
- 执行接口测试脚本：启动项目，项目路径为：`{{项目路径}}`，并执行接口测试脚本。文件名字要严格匹配，且该目录只生成这一个文件。
- 生成接口测试报告：`{{项目路径}}/refactor/4-eval/{{当前日期}}/{{模块名称}}/{{模块名称}}-test-api-eval.md`。文件名字要严格匹配，且该目录只生成这一个文件。文档内容主体是中文，包括接口测试用例、测试步骤、预期结果、实际结果、测试状态、测试时间等。

**4.1.2 依赖关系分析**
- 分析模块内部依赖关系
- 识别外部模块依赖和第三方依赖
- 绘制依赖关系图，识别循环依赖风险

**4.1.3 数据模型分析**
- 梳理现有实体关系
- 分析PO对象和业务对象的映射关系
- 识别数据访问模式和查询复杂度

### 阶段二：领域层重构（第2-3周）

**4.2.1 实体和值对象重构**
{{基于具体模块的实体重构计划}}

**4.2.2 仓储接口设计**
{{基于数据访问分析的仓储设计方案}}

**4.2.3 领域服务提取**
{{基于业务逻辑分析的领域服务设计}}

### 阶段三：应用服务层重构（第3-4周）

**4.3.1 应用服务实现**
{{基于用例分析的应用服务设计}}

**4.3.2 DTO设计优化**
{{基于接口分析的DTO优化方案}}

### 阶段四：基础设施层重构（第4-5周）

**4.4.1 仓储实现重构**
{{基于数据访问的实现方案}}

**4.4.2 缓存策略优化**
{{基于性能分析的缓存方案}}

### 阶段五：接口层重构（第5-6周）

**4.5.1 控制器重构**
- **⚠️ 重要约束**：不得修改任何现有API的URL、入参格式、返回格式
- 重构内部实现逻辑，调用新的应用服务
- 保持异常处理和响应格式完全一致

**4.5.2 接口测试验证**
- 执行接口测试脚本：重构完，重启项目，项目路径为：`{{项目路径}}`，再次执行{{模块名称}}接口测试脚本
- 生成文档内容主体是中文
- 接口测试报告比对：执行接口测试脚本中每个接口，并将结果跟`{{项目路径}}/refactor/4-eval/{{当前日期}}/{{模块名称}}/{{模块名称}}-test-api-eval.md`进行对比，将对比结果进度和状态同步到该接口测试报告中

## 5. 验收标准

### 5.1 功能验收标准
- [ ] **接口兼容性**：所有原有API接口URL、参数、返回值格式保持100%一致
- [ ] **业务逻辑**：所有业务用例执行结果与重构前完全一致
- [ ] **数据完整性**：数据读写操作结果无任何差异

### 5.2 质量验收标准  
- [ ] **代码编译**：所有代码编译通过，无编译错误和警告
- [ ] **测试覆盖**：单元测试覆盖率≥80%
- [ ] **代码质量**：代码重复率<5%，复杂度评级≥B级

### 5.3 架构验收标准
- [ ] **DDD架构**：严格遵循DDD分层架构和命名规范
- [ ] **依赖管理**：消除循环依赖，依赖方向符合架构原则
- [ ] **接口设计**：API设计遵循RESTful规范

---

## 🔧 AI填写指导

**在使用此模板时，请确保：**

1. **准确提取信息**：从参考文档中提取准确的业务信息和技术现状
2. **具体化描述**：将所有 `{{占位符}}` 替换为具体、详细的内容
3. **保持一致性**：确保重构计划与参考文档中的整体策略保持一致
4. **验证可行性**：确保所有计划都具有实际可操作性
5. **风险评估**：基于实际情况识别和评估具体的风险点

**质量检查清单**：
- [ ] 所有占位符已被具体内容替换
- [ ] 业务分析准确反映模块实际情况  
- [ ] 重构计划具有可操作性和时间节点
- [ ] 风险识别和缓解措施切实可行
- [ ] 验收标准明确且可验证
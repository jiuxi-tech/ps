# sys模块接口测试文档

> **生成时间**：2025-09-18  
> **模块名称**：sys（系统管理模块）  
> **测试版本**：v1.0

## 1. 测试概述

本文档提供sys模块所有接口的详细测试用例，包括正常场景和异常场景的测试验证。

## 2. 字典管理接口测试

### 2.1 创建字典测试

**测试接口**：`POST /system/dictionary`

#### 2.1.1 正常场景测试
**测试用例1：成功创建字典**
- **测试数据**：
```json
{
  "dictCode": "TEST_DICT_001",
  "dictName": "测试字典",
  "dictDesc": "这是一个测试字典",
  "dictType": "BUSINESS",
  "status": "ACTIVE",
  "orderIndex": 1,
  "tenantId": "default"
}
```
- **预期结果**：
  - HTTP状态码：200
  - 响应码：200
  - 响应消息："创建成功"
  - 返回创建后的字典数据

#### 2.1.2 异常场景测试
**测试用例2：重复字典编码**
- **测试数据**：使用已存在的dictCode
- **预期结果**：
  - HTTP状态码：200
  - 响应码：500
  - 响应消息包含错误信息

**测试用例3：必填字段为空**
- **测试数据**：dictCode或dictName为空
- **预期结果**：
  - HTTP状态码：200
  - 响应码：500
  - 响应消息包含参数验证错误

### 2.2 更新字典测试

**测试接口**：`PUT /system/dictionary`

#### 2.2.1 正常场景测试
**测试用例1：成功更新字典**
- **前置条件**：字典已存在
- **测试数据**：
```json
{
  "dictId": "existing_dict_id",
  "dictName": "更新后的字典名称",
  "dictDesc": "更新后的描述",
  "status": "INACTIVE"
}
```
- **预期结果**：
  - HTTP状态码：200
  - 响应码：200
  - 响应消息："更新成功"
  - 返回更新后的字典数据

#### 2.2.2 异常场景测试
**测试用例2：字典不存在**
- **测试数据**：不存在的dictId
- **预期结果**：
  - HTTP状态码：200
  - 响应码：500
  - 响应消息："字典不存在"

### 2.3 删除字典测试

**测试接口**：`DELETE /system/dictionary/{dictId}`

#### 2.3.1 正常场景测试
**测试用例1：成功删除字典**
- **前置条件**：字典已存在
- **测试步骤**：
  1. 调用删除接口传入存在的dictId
- **预期结果**：
  - HTTP状态码：200
  - 响应码：200
  - 响应消息："删除成功"

#### 2.3.2 异常场景测试
**测试用例2：删除不存在的字典**
- **测试步骤**：传入不存在的dictId
- **预期结果**：
  - HTTP状态码：200
  - 响应码：500
  - 响应消息包含错误信息

### 2.4 查询字典测试

**测试接口1**：`GET /system/dictionary/{dictId}`
**测试接口2**：`GET /system/dictionary/code/{dictCode}`

#### 2.4.1 根据ID查询测试
**测试用例1：成功查询**
- **前置条件**：字典已存在
- **测试步骤**：传入存在的dictId
- **预期结果**：
  - HTTP状态码：200
  - 响应码：200
  - 响应消息："查询成功"
  - 返回字典详细数据

**测试用例2：查询不存在的字典**
- **测试步骤**：传入不存在的dictId
- **预期结果**：
  - HTTP状态码：200
  - 响应码：404
  - 响应消息："字典不存在"

#### 2.4.2 根据编码查询测试
**测试用例1：成功查询**
- **测试数据**：
  - dictCode: "TEST_DICT_001"
  - tenantId: "default"（可选）
- **预期结果**：
  - HTTP状态码：200
  - 响应码：200
  - 返回对应字典数据

**测试用例2：多租户查询**
- **测试数据**：
  - dictCode: "TEST_DICT_001"
  - tenantId: "tenant1"
- **预期结果**：根据租户返回对应数据或404

## 3. 系统配置管理接口测试

### 3.1 配置列表查询测试

**测试接口**：`POST /sys/config/list`

#### 3.1.1 正常场景测试
**测试用例1：分页查询配置**
- **测试数据**：
```json
{
  "current": 1,
  "size": 10,
  "configKey": "",
  "configValue": ""
}
```
- **预期结果**：
  - HTTP状态码：200
  - 返回JsonResponse格式
  - data字段包含IPage分页数据

### 3.2 配置保存测试

**测试接口**：`POST /sys/config/save`

#### 3.2.1 正常场景测试
**测试用例1：新增配置**
- **测试数据**：
```
configKey=test.config.key
configValue=test.config.value
description=测试配置项
```
- **预期结果**：
  - HTTP状态码：200
  - 返回JsonResponse成功响应

**测试用例2：更新配置**
- **前置条件**：配置已存在
- **测试数据**：相同configKey，不同configValue
- **预期结果**：配置值被更新

### 3.3 配置查询测试

**测试接口1**：`POST /sys/config/view`
**测试接口2**：`POST /sys/config/value/{configKey}`
**测试接口3**：`POST /sys/config/get`

#### 3.3.1 查看配置详情测试
**测试用例1：查询存在的配置**
- **测试数据**：configKey="existing.config.key"
- **预期结果**：返回完整的TpSystemConfig对象

**测试用例2：查询不存在的配置**
- **测试数据**：configKey="non.existing.key"
- **预期结果**：返回null或空数据

#### 3.3.2 获取配置值测试
**测试用例1：路径参数方式**
- **测试接口**：`POST /sys/config/value/test.config.key`
- **预期结果**：返回配置值字符串

**测试用例2：查询参数方式**
- **测试数据**：configKey="test.config.key"
- **预期结果**：返回相同的配置值

### 3.4 批量操作测试

**测试接口1**：`POST /sys/config/delete`
**测试接口2**：`POST /sys/config/batch-update`

#### 3.4.1 批量删除测试
**测试用例1：删除多个配置**
- **测试数据**：configKeys="key1,key2,key3"
- **预期结果**：所有指定配置被删除

#### 3.4.2 批量更新测试
**测试用例1：批量更新配置**
- **测试数据**：
```json
{
  "config.key1": "new.value1",
  "config.key2": "new.value2",
  "config.key3": "new.value3"
}
```
- **预期结果**：所有配置值被更新

### 3.5 获取所有配置测试

**测试接口**：`POST /sys/config/all`

#### 3.5.1 正常场景测试
**测试用例1：获取全部配置**
- **测试步骤**：直接调用接口
- **预期结果**：
  - 返回Map<String, String>格式
  - 包含系统所有配置的键值对

### 3.6 功能测试接口

**测试接口**：`POST /sys/config/test_config_management`

#### 3.6.1 功能验证测试
**测试用例1：验证配置管理功能**
- **测试步骤**：调用测试接口
- **预期结果**：返回"系统配置管理功能正常"

## 4. 权限测试

### 4.1 字典管理权限测试
- **测试场景**：无需特殊权限验证
- **测试方法**：直接调用接口验证功能

### 4.2 系统配置权限测试
- **测试场景**：需要@Authorization权限验证
- **测试用例1**：有效权限访问
  - **预期结果**：正常访问接口
- **测试用例2**：无权限访问
  - **预期结果**：返回权限验证失败

## 5. 性能测试

### 5.1 并发测试
- **测试场景**：同时创建多个字典
- **测试用例**：100个并发请求
- **预期结果**：所有请求正常处理，无数据异常

### 5.2 大数据量测试
- **测试场景**：分页查询大量配置数据
- **测试用例**：查询包含1000+配置的列表
- **预期结果**：响应时间<2秒

## 6. 数据完整性测试

### 6.1 事务测试
- **测试场景**：批量操作中出现异常
- **测试方法**：在批量更新中故意造成部分失败
- **预期结果**：整个事务回滚，数据保持一致

### 6.2 缓存一致性测试
- **测试场景**：配置更新后缓存同步
- **测试步骤**：
  1. 更新配置
  2. 立即查询配置
  3. 验证缓存是否更新
- **预期结果**：配置和缓存保持一致

## 7. 异常恢复测试

### 7.1 数据库连接异常测试
- **测试场景**：模拟数据库连接中断
- **预期结果**：返回适当的错误信息，不暴露系统内部异常

### 7.2 网络异常测试
- **测试场景**：模拟网络超时
- **预期结果**：合理的超时处理和错误提示

## 8. 测试执行计划

### 8.1 测试环境准备
1. 搭建测试环境
2. 准备测试数据
3. 配置权限和认证

### 8.2 测试执行顺序
1. 基础功能测试（CRUD操作）
2. 权限验证测试
3. 异常场景测试
4. 性能和并发测试
5. 数据完整性测试

### 8.3 测试验收标准
- 所有正常场景测试通过
- 异常场景得到正确处理
- 权限验证正常工作
- 性能指标满足要求
- 数据完整性得到保证
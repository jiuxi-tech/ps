# org模块接口测试文档

> **生成时间**：2025-09-17  
> **模块路径**：`D:\keycloak_sb_sso_new0910_claude\ps\ps-be\src\main\java\com\jiuxi\module\org`  
> **测试版本**：v1.0

## 🧪 测试概览

本文档提供org模块所有接口的完整测试用例，包括正常场景、异常场景和边界场景的测试。测试覆盖部门管理、企业管理、组织架构管理等核心功能。

## 🏗️ 测试环境准备

### 测试前置条件
1. **数据库准备**：确保测试数据库中有基础的租户、部门、企业数据
2. **认证准备**：准备有效的JWT Token，包含用户和租户信息
3. **权限准备**：确保测试账号具有相应的业务权限
4. **环境变量**：设置正确的服务器地址和端口

### 测试数据准备
```sql
-- 准备测试租户
INSERT INTO tenant (tenant_id, tenant_name) VALUES ('test-tenant-001', '测试租户');

-- 准备测试部门
INSERT INTO tp_dept_basicinfo (dept_id, dept_name, tenant_id) VALUES 
('test-dept-001', '测试根部门', 'test-tenant-001'),
('test-dept-002', '测试子部门', 'test-tenant-001');

-- 准备测试企业
INSERT INTO tp_ent_basicinfo (ent_id, ent_full_name, tenant_id) VALUES 
('test-ent-001', '测试企业有限公司', 'test-tenant-001');
```

### Header配置
```
Content-Type: application/json
Authorization: Bearer {jwt_token}
X-User-Person-Id: test-user-001
X-Tenant-Id: test-tenant-001
```

## 🏢 1. 部门管理接口测试

### 1.1 创建部门接口测试

#### 测试用例 1.1.1：正常创建部门
**接口**：`POST /api/v1/departments`

**测试步骤**：
1. 构造创建部门的请求数据
2. 发送POST请求到创建部门接口
3. 验证响应状态码为200
4. 验证返回的部门信息完整性
5. 验证数据库中部门记录已创建

**测试数据**：
```json
{
  "deptName": "技术部",
  "deptSimpleName": "技术部",
  "deptFullName": "信息技术部",
  "parentDeptId": "test-dept-001",
  "type": "FUNCTIONAL",
  "managerId": "manager-001",
  "contactPhone": "010-12345678",
  "address": "北京市朝阳区",
  "description": "负责技术开发工作",
  "orderIndex": 1
}
```

**期望结果**：
- 状态码：200
- 响应数据包含完整的部门信息
- 部门ID不为空
- 部门层级和路径计算正确

#### 测试用例 1.1.2：创建部门参数验证失败
**测试步骤**：
1. 构造缺少必填字段的请求数据
2. 发送POST请求
3. 验证返回400错误
4. 验证错误信息包含字段验证失败详情

**测试数据**：
```json
{
  "deptSimpleName": "技术部",
  "parentDeptId": "test-dept-001"
}
```

**期望结果**：
- 状态码：400
- 错误信息提示部门名称不能为空

#### 测试用例 1.1.3：创建部门父部门不存在
**测试步骤**：
1. 构造父部门ID不存在的请求数据
2. 发送POST请求
3. 验证返回业务错误
4. 验证错误信息提示父部门不存在

**测试数据**：
```json
{
  "deptName": "测试部门",
  "parentDeptId": "nonexistent-dept-id"
}
```

**期望结果**：
- 状态码：200，但success为false
- 错误信息提示父部门不存在

### 1.2 更新部门接口测试

#### 测试用例 1.2.1：正常更新部门信息
**接口**：`PUT /api/v1/departments/{deptId}`

**测试步骤**：
1. 准备要更新的部门ID
2. 构造更新请求数据
3. 发送PUT请求
4. 验证响应状态码和返回数据
5. 验证数据库中部门信息已更新

**测试数据**：
```json
{
  "deptName": "技术研发部",
  "deptSimpleName": "研发部",
  "description": "负责技术研发和创新工作"
}
```

**期望结果**：
- 状态码：200
- 返回更新后的部门信息
- 数据库记录已更新

#### 测试用例 1.2.2：更新不存在的部门
**测试步骤**：
1. 使用不存在的部门ID
2. 发送PUT请求
3. 验证返回404错误

**期望结果**：
- 错误信息提示部门不存在

### 1.3 查询部门详情接口测试

#### 测试用例 1.3.1：正常查询部门详情
**接口**：`GET /api/v1/departments/{deptId}`

**测试步骤**：
1. 使用存在的部门ID
2. 发送GET请求
3. 验证返回的部门信息完整性

**期望结果**：
- 状态码：200
- 返回完整的部门信息
- 所有字段数据正确

#### 测试用例 1.3.2：查询不存在的部门
**测试步骤**：
1. 使用不存在的部门ID
2. 发送GET请求
3. 验证返回404错误

**期望结果**：
- 错误信息提示部门不存在

### 1.4 部门树形查询接口测试

#### 测试用例 1.4.1：获取部门树形结构
**接口**：`GET /api/v1/departments/tree`

**测试步骤**：
1. 发送GET请求获取部门树
2. 验证返回的树形结构正确性
3. 验证父子关系正确
4. 验证层级关系正确

**期望结果**：
- 状态码：200
- 返回树形结构数据
- 父子关系正确
- 层级顺序正确

#### 测试用例 1.4.2：根据父部门查询子部门
**接口**：`GET /api/v1/departments/parent/{parentDeptId}`

**测试步骤**：
1. 使用存在子部门的父部门ID
2. 发送GET请求
3. 验证返回的子部门列表
4. 验证只返回直接子部门

**期望结果**：
- 状态码：200
- 返回直接子部门列表
- 不包含更深层级的部门

### 1.5 部门删除接口测试

#### 测试用例 1.5.1：正常删除部门
**接口**：`DELETE /api/v1/departments/{deptId}`

**测试步骤**：
1. 选择可删除的部门（无子部门、无人员）
2. 发送DELETE请求
3. 验证删除成功
4. 验证数据库中记录已删除

**期望结果**：
- 状态码：200
- 删除成功消息
- 数据库记录已删除

#### 测试用例 1.5.2：删除有子部门的部门
**测试步骤**：
1. 选择有子部门的父部门
2. 发送DELETE请求
3. 验证删除失败
4. 验证错误信息提示存在子部门

**期望结果**：
- 删除失败
- 错误信息提示存在子部门，不能删除

### 1.6 部门状态管理接口测试

#### 测试用例 1.6.1：启用部门
**接口**：`PUT /api/v1/departments/{deptId}/enable`

**测试步骤**：
1. 选择停用状态的部门
2. 发送PUT请求启用部门
3. 验证启用成功
4. 验证部门状态已更新

**期望结果**：
- 状态码：200
- 启用成功消息
- 部门状态变为启用

#### 测试用例 1.6.2：停用部门
**接口**：`PUT /api/v1/departments/{deptId}/disable`

**测试步骤**：
1. 选择启用状态的部门
2. 发送PUT请求停用部门
3. 验证停用成功
4. 验证部门状态已更新

**期望结果**：
- 状态码：200
- 停用成功消息
- 部门状态变为停用

### 1.7 部门高级查询接口测试

#### 测试用例 1.7.1：查询部门祖先链
**接口**：`GET /api/v1/departments/{deptId}/ancestors`

**测试步骤**：
1. 选择多层级部门的子部门
2. 发送GET请求查询祖先链
3. 验证返回的祖先部门列表
4. 验证层级顺序正确

**期望结果**：
- 状态码：200
- 返回从根部门到直接父部门的列表
- 顺序正确

#### 测试用例 1.7.2：查询部门后代
**接口**：`GET /api/v1/departments/{deptId}/descendants`

**测试步骤**：
1. 选择有多层级子部门的父部门
2. 发送GET请求查询后代
3. 验证返回所有后代部门
4. 测试includeInactive参数

**期望结果**：
- 状态码：200
- 返回所有后代部门
- includeInactive=false时不包含停用部门

### 1.8 部门统计接口测试

#### 测试用例 1.8.1：获取部门统计信息
**接口**：`GET /api/v1/departments/{deptId}/statistics`

**测试步骤**：
1. 选择有子部门和人员的部门
2. 发送GET请求获取统计信息
3. 验证返回的统计数据正确性

**期望结果**：
- 状态码：200
- 返回详细统计信息
- 子部门数量正确
- 人员数量正确

#### 测试用例 1.8.2：获取租户部门概览
**接口**：`GET /api/v1/departments/overview`

**测试步骤**：
1. 发送GET请求获取概览统计
2. 验证返回的概览数据
3. 验证总数、激活数等统计准确

**期望结果**：
- 状态码：200
- 返回租户部门概览数据
- 各项统计数据准确

## 🏢 2. 企业管理接口测试

### 2.1 企业列表查询接口测试

#### 测试用例 2.1.1：正常分页查询企业列表
**接口**：`POST /sys/ent/list`

**测试步骤**：
1. 构造分页查询参数
2. 发送POST请求
3. 验证返回的分页数据格式
4. 验证企业信息完整性

**测试数据**：
```json
{
  "current": 1,
  "size": 10,
  "entFullName": "测试企业"
}
```

**期望结果**：
- 状态码：200
- 返回分页格式的企业列表
- 总数和当前页数据正确

#### 测试用例 2.1.2：空条件查询
**测试步骤**：
1. 发送空条件的查询请求
2. 验证返回所有企业数据
3. 验证分页参数正确

**期望结果**：
- 返回所有企业数据
- 分页信息正确

### 2.2 企业信息管理接口测试

#### 测试用例 2.2.1：查看企业详情
**接口**：`POST /sys/ent/view`

**测试步骤**：
1. 使用存在的企业ID
2. 发送POST请求
3. 验证返回的企业详细信息

**测试数据**：
```json
{
  "entId": "test-ent-001"
}
```

**期望结果**：
- 状态码：200
- 返回完整的企业信息

#### 测试用例 2.2.2：新增企业
**接口**：`POST /sys/ent/add`

**测试步骤**：
1. 构造企业基本信息
2. 发送POST请求创建企业
3. 验证创建成功
4. 验证返回企业ID

**测试数据**：
```json
{
  "entFullName": "新测试企业有限公司",
  "entSimpleName": "新测试企业",
  "entUnifiedCode": "91110000000000001X",
  "legalRepr": "张三",
  "linkPsnName": "李四",
  "linkPsnTel": "13800138000"
}
```

**期望结果**：
- 状态码：200
- 返回新创建的企业ID
- 数据库记录已创建

#### 测试用例 2.2.3：修改企业信息
**接口**：`POST /sys/ent/update`

**测试步骤**：
1. 准备要修改的企业信息
2. 发送POST请求
3. 验证修改成功
4. 验证数据库记录已更新

**测试数据**：
```json
{
  "entId": "test-ent-001",
  "entFullName": "修改后的企业名称",
  "entDesc": "修改后的企业描述"
}
```

**期望结果**：
- 状态码：200
- 修改成功
- 数据库记录已更新

#### 测试用例 2.2.4：删除企业
**接口**：`POST /sys/ent/delete`

**测试步骤**：
1. 选择可删除的企业ID
2. 发送POST请求
3. 验证删除成功
4. 验证数据库记录已删除

**期望结果**：
- 状态码：200
- 删除成功
- 数据库记录已删除

### 2.3 企业账号管理接口测试

#### 测试用例 2.3.1：获取企业管理员列表
**接口**：`POST /sys/ent/ent-admin-list`

**测试步骤**：
1. 构造查询条件
2. 发送POST请求
3. 验证返回的管理员列表
4. 验证分页信息正确

**期望结果**：
- 状态码：200
- 返回企业管理员列表
- 分页信息正确

## 🏗️ 3. 组织部门管理接口测试

### 3.1 机构树查询接口测试

#### 测试用例 3.1.1：政府机构树查询
**接口**：`POST /sys/dept/org/tree`

**测试步骤**：
1. 构造机构树查询参数
2. 发送POST请求
3. 验证返回的树形结构
4. 验证节点层级关系

**测试数据**：
```json
{
  "deptId": "",
  "jwtdid": "test-dept-001",
  "sync": 1
}
```

**期望结果**：
- 状态码：200
- 返回树形结构数据
- 节点信息完整

#### 测试用例 3.1.2：企业部门树查询
**接口**：`POST /sys/dept/ent/tree`

**测试步骤**：
1. 构造企业部门树查询参数
2. 发送POST请求
3. 验证返回的企业部门树
4. 验证admin账号返回空列表

**期望结果**：
- 状态码：200
- 返回企业部门树
- admin账号返回空列表

### 3.2 层级查询接口测试

#### 测试用例 3.2.1：查询下级部门
**接口**：`POST /sys/dept/children`

**测试步骤**：
1. 使用父部门ID查询下级
2. 测试不同的deptType参数
3. 验证过滤功能正常

**测试数据**：
```json
{
  "parentId": "test-dept-001",
  "deptType": "SYS0502",
  "filterCommAscn": "1",
  "category": 1
}
```

**期望结果**：
- 状态码：200
- 返回下级部门列表
- 过滤条件生效

### 3.3 部门信息管理接口测试

#### 测试用例 3.3.1：新增政府组织
**接口**：`POST /sys/dept/org/add`

**测试步骤**：
1. 构造政府组织信息
2. 发送POST请求
3. 验证创建成功
4. 验证组织类型正确

**测试数据**：
```json
{
  "deptName": "测试政府机构",
  "parentDeptId": "test-dept-001",
  "deptType": "SYS0501"
}
```

**期望结果**：
- 状态码：200
- 创建成功
- 组织类型为政府

#### 测试用例 3.3.2：新增企业部门
**接口**：`POST /sys/dept/ent/add`

**测试步骤**：
1. 构造企业部门信息
2. 发送POST请求
3. 验证创建成功
4. 验证部门类型正确

**期望结果**：
- 状态码：200
- 创建成功
- 部门类型为企业

## 📱 4. 移动端接口测试

### 4.1 移动端机构树接口测试

#### 测试用例 4.1.1：移动端机构树查询
**接口**：`POST /app/sys/dept/org/tree`

**测试步骤**：
1. 发送移动端机构树查询请求
2. 验证无需权限验证
3. 验证返回数据格式正确

**期望结果**：
- 状态码：200
- 无需权限验证
- 返回完整机构树

## 🧪 异常场景测试

### 异常测试用例集

#### 异常用例 E.1：网络超时测试
**测试步骤**：
1. 设置网络延迟或超时
2. 发送请求
3. 验证超时处理机制

**期望结果**：
- 返回超时错误
- 系统保持稳定

#### 异常用例 E.2：无效Token测试
**测试步骤**：
1. 使用过期或无效的JWT Token
2. 发送需要认证的请求
3. 验证认证失败处理

**期望结果**：
- 返回401认证失败
- 提示Token无效

#### 异常用例 E.3：权限不足测试
**测试步骤**：
1. 使用权限不足的账号
2. 发送需要特定权限的请求
3. 验证权限验证机制

**期望结果**：
- 返回403权限不足
- 提示权限不够

#### 异常用例 E.4：数据库连接失败测试
**测试步骤**：
1. 模拟数据库连接异常
2. 发送数据库操作请求
3. 验证异常处理机制

**期望结果**：
- 返回500服务器错误
- 系统优雅降级

## 🔍 边界场景测试

### 边界测试用例集

#### 边界用例 B.1：大数据量测试
**测试步骤**：
1. 创建大量测试数据（1000+部门）
2. 发送查询请求
3. 验证性能和稳定性

**期望结果**：
- 响应时间在可接受范围内
- 内存使用正常
- 无系统崩溃

#### 边界用例 B.2：深层级部门测试
**测试步骤**：
1. 创建深层级的部门结构（10+层级）
2. 测试树形查询功能
3. 验证层级计算正确性

**期望结果**：
- 树形查询正常
- 层级计算正确
- 路径计算准确

#### 边界用例 B.3：长字符串测试
**测试步骤**：
1. 使用最大长度的字符串作为部门名称
2. 发送创建请求
3. 验证字段长度验证

**期望结果**：
- 符合长度限制的请求成功
- 超长字符串被正确拒绝

## 📊 性能测试

### 性能测试用例

#### 性能用例 P.1：并发创建部门测试
**测试步骤**：
1. 启动100个并发线程
2. 同时创建不同的部门
3. 监控系统性能指标

**期望结果**：
- 所有请求成功处理
- 响应时间平均<500ms
- 系统资源使用正常

#### 性能用例 P.2：高频查询测试
**测试步骤**：
1. 持续发送查询请求（1000次/分钟）
2. 监控响应时间和成功率
3. 验证缓存机制有效性

**期望结果**：
- 响应时间稳定
- 成功率>99%
- 缓存命中率高

## 📋 测试检查清单

### 功能测试检查清单
- [ ] 所有CRUD操作功能正常
- [ ] 树形查询功能正确
- [ ] 权限验证机制有效
- [ ] 数据验证规则生效
- [ ] 异常处理机制完善

### 接口测试检查清单
- [ ] 所有接口返回正确状态码
- [ ] 响应数据格式符合规范
- [ ] 错误信息准确明确
- [ ] 分页功能正常
- [ ] 查询过滤功能有效

### 数据一致性检查清单
- [ ] 数据库操作事务性
- [ ] 级联操作数据一致
- [ ] 缓存和数据库同步
- [ ] 多租户数据隔离
- [ ] 并发操作数据安全

### 性能测试检查清单
- [ ] 响应时间符合要求
- [ ] 并发处理能力达标
- [ ] 内存使用合理
- [ ] 数据库连接池正常
- [ ] 缓存机制有效

## 📝 测试报告模板

### 测试结果记录
```
测试用例编号：
测试用例名称：
执行时间：
测试结果：通过/失败
实际结果：
期望结果：
问题描述：
```

### 缺陷报告模板
```
缺陷编号：
缺陷标题：
严重级别：严重/一般/轻微
重现步骤：
实际结果：
期望结果：
测试环境：
```
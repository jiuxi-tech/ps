# role模块接口测试文档

> **文档生成时间**：2025-09-15  
> **模块名称**：role（角色权限管理模块）  
> **测试范围**：AuthorizationRoleController全部接口

## 测试环境准备

### 基础环境要求
1. **应用服务**: ps-be项目正常启动运行
2. **数据库连接**: 确保数据库连接正常，相关表数据完整
3. **认证服务**: JWT认证服务可用
4. **测试工具**: Postman、curl或其他HTTP测试工具

### 测试数据准备
1. **测试用户**: 准备有效的JWT token
2. **角色数据**: 准备测试角色数据  
3. **权限数据**: 准备菜单权限数据
4. **人员数据**: 准备测试人员和部门数据

## 接口测试用例

### 1. 角色授权列表查询接口测试

**接口**: `POST /sys/role/roleAuthList`

#### 测试用例1.1: 正常查询测试
**测试步骤**:
1. 准备有效的JWT认证信息
2. 构造TpRoleAuthQuery查询条件
3. 发送POST请求到 `/sys/role/roleAuthList`
4. 验证返回结果

**请求参数**:
```json
{
  "query": {
    "roleName": "",
    "status": 1
  },
  "jwtpid": "test_person_id",
  "jwtdid": "test_dept_id", 
  "jwtrids": "role1,role2",
  "jwtaid": "test_app_id"
}
```

**预期结果**: 
- HTTP状态码: 200
- 返回JSON格式数据，包含success=true
- data字段包含LinkedHashSet类型的角色列表

#### 测试用例1.2: 空参数查询测试
**测试步骤**: 不传递任何查询参数，验证默认行为
**预期结果**: 返回当前用户可见的全部角色

#### 测试用例1.3: 无权限用户测试
**测试步骤**: 使用无权限的JWT token进行查询
**预期结果**: 返回权限错误或空列表

### 2. 角色分页列表查询接口测试

**接口**: `POST /sys/role/list`

#### 测试用例2.1: 正常分页查询测试
**测试步骤**:
1. 构造包含分页参数的TpRoleQuery
2. 发送请求并验证分页结果
3. 检查总数、页数、数据完整性

**请求参数**:
```json
{
  "query": {
    "current": 1,
    "size": 10,
    "roleName": "",
    "status": 1
  },
  "jwtpid": "test_person_id",
  "jwtrids": "role1,role2", 
  "jwtaid": "test_app_id"
}
```

**预期结果**:
- 返回IPage对象包含分页信息
- records字段包含当前页数据
- total字段显示总记录数

#### 测试用例2.2: 边界值测试
**测试步骤**: 测试分页边界情况（第一页、最后一页、超出范围）
**预期结果**: 正确处理边界情况，不出现异常

### 3. 政府角色列表查询接口测试

**接口**: `POST /sys/role/org/list`

#### 测试用例3.1: 政府角色查询测试
**测试步骤**:
1. 发送请求到政府角色专用接口
2. 验证返回的角色category字段均为0
3. 确认只包含政府类别角色

**请求参数**:
```json
{
  "query": {
    "current": 1,
    "size": 10
  },
  "jwtpid": "test_person_id",
  "jwtrids": "role1,role2",
  "jwtaid": "test_app_id"  
}
```

**预期结果**: 返回的所有角色数据category字段为0

### 4. 角色新增接口测试

**接口**: `POST /sys/role/add`

#### 测试用例4.1: 正常新增测试
**测试步骤**:
1. 构造完整的角色数据
2. 发送新增请求
3. 验证返回结果和数据库数据

**请求参数**:
```json
{
  "vo": {
    "roleName": "测试角色",
    "roleDesc": "这是一个测试角色", 
    "status": 1,
    "remark": "测试用"
  },
  "jwtpid": "test_person_id",
  "jwtaid": "test_app_id"
}
```

**预期结果**: 
- 返回success=true
- data字段为大于0的整数
- 数据库中新增对应记录

#### 测试用例4.2: 必填字段验证测试
**测试步骤**: 提交缺少必填字段的数据
**预期结果**: 返回参数校验错误信息

#### 测试用例4.3: 重复角色名测试
**测试步骤**: 提交已存在的角色名称
**预期结果**: 返回业务逻辑错误信息

### 5. 政府角色新增接口测试

**接口**: `POST /sys/role/org/add`

#### 测试用例5.1: 政府角色新增测试
**测试步骤**: 按照政府角色新增接口提交数据
**预期结果**: 新增的角色category自动设置为0

### 6. 用户授权接口测试

**接口**: `POST /sys/role/auth-add`

#### 测试用例6.1: 正常授权测试
**测试步骤**:
1. 准备有效的人员ID、部门ID和角色ID
2. 发送授权请求
3. 验证转发到UserPersonController的结果

**请求参数**:
```json
{
  "personId": "test_person_id",
  "deptId": "test_dept_id",
  "roleIds": ",role1,role2,role3"
}
```

**预期结果**: 成功转发请求并返回正确结果

#### 测试用例6.2: 参数验证测试
**测试步骤**: 分别测试personId和deptId为空的情况
**预期结果**: 返回相应的参数错误信息

#### 测试用例6.3: roleIds格式处理测试
**测试步骤**: 测试roleIds开头带逗号的情况
**预期结果**: 自动去除开头逗号并正确处理

### 7. 角色更新接口测试

**接口**: `POST /sys/role/update`

#### 测试用例7.1: 正常更新测试
**测试步骤**:
1. 准备待更新的角色数据（包含roleId）
2. 修改部分字段值
3. 发送更新请求
4. 验证更新结果

**请求参数**:
```json
{
  "vo": {
    "roleId": "existing_role_id",
    "roleName": "更新后的角色名",
    "roleDesc": "更新后的描述",
    "status": 1
  },
  "jwtpid": "test_person_id"
}
```

**预期结果**: 更新成功，数据库记录被正确修改

#### 测试用例7.2: 不存在角色更新测试
**测试步骤**: 使用不存在的roleId进行更新
**预期结果**: 返回相应错误信息

### 8. 角色详情查看接口测试

**接口**: `GET /sys/role/view`

#### 测试用例8.1: 正常查看测试
**测试步骤**:
1. 使用有效的roleId查询角色详情
2. 验证返回数据的完整性

**请求参数**: `roleId=existing_role_id`

**预期结果**: 返回完整的角色详细信息

#### 测试用例8.2: 不存在角色查看测试
**测试步骤**: 使用不存在的roleId
**预期结果**: 返回空数据或错误信息

### 9. 角色人员关系查询接口测试

**接口**: `GET /sys/role/selectByRoleId`

#### 测试用例9.1: 正常关系查询测试
**测试步骤**: 使用有人员关联的角色ID查询
**预期结果**: 返回该角色下的所有人员关系列表

#### 测试用例9.2: 无人员角色查询测试
**测试步骤**: 使用没有人员关联的角色ID查询
**预期结果**: 返回空列表

#### 测试用例9.3: 兼容接口测试
**测试步骤**: 使用 `/sys/role/select-by-roleid` 接口进行相同测试
**预期结果**: 结果与selectByRoleId接口完全一致

### 10. 角色删除接口测试

**接口**: `POST /sys/role/delete`

#### 测试用例10.1: 正常删除测试
**测试步骤**:
1. 准备可删除的角色ID
2. 发送删除请求
3. 验证数据库记录被删除

**请求参数**:
```json
{
  "roleId": "deletable_role_id",
  "creator": "test_creator_id", 
  "jwtpid": "test_person_id"
}
```

**预期结果**: 删除成功，相关记录被移除

#### 测试用例10.2: 删除有关联的角色测试
**测试步骤**: 尝试删除有人员关联的角色
**预期结果**: 根据业务规则返回错误或级联删除

### 11. 权限树获取接口测试

**接口**: `GET /sys/role/authTree`

#### 测试用例11.1: 正常权限树获取测试
**测试步骤**:
1. 使用有效角色ID获取权限树
2. 验证树形结构的完整性

**请求参数**: 
```
roleId=test_role_id&jwtrids=role1,role2&jwtpid=test_person_id
```

**预期结果**: 返回完整的树形权限结构

#### 测试用例11.2: 兼容URL格式测试
**测试步骤**: 使用 `/sys/role/auth-tree` 接口进行相同测试
**预期结果**: 结果与authTree接口完全一致

### 12. 角色菜单权限配置接口测试

**接口**: `POST /sys/role/roleMenus`

#### 测试用例12.1: 正常权限配置测试
**测试步骤**:
1. 准备角色ID和菜单ID列表
2. 发送权限配置请求
3. 验证权限关系被正确建立

**请求参数**:
```json
{
  "roleId": "test_role_id",
  "menuIds": "menu1,menu2,menu3"
}
```

**预期结果**: 权限关系配置成功

#### 测试用例12.2: 清空权限测试
**测试步骤**: 传递空的menuIds
**预期结果**: 清空该角色的所有菜单权限

## 测试执行步骤

### 准备阶段
1. **环境检查**: 确认测试环境可用
2. **数据准备**: 初始化测试数据
3. **工具配置**: 设置测试工具和脚本

### 执行阶段
1. **功能测试**: 按照用例顺序执行功能测试
2. **异常测试**: 执行各种异常情况测试
3. **性能测试**: 测试接口响应时间和并发能力

### 验证阶段
1. **结果验证**: 验证所有测试结果符合预期
2. **数据一致性检查**: 检查数据库数据正确性
3. **日志分析**: 分析应用日志确认无异常

## 测试报告模板

### 测试结果统计
- 总测试用例数: XX个
- 通过用例数: XX个  
- 失败用例数: XX个
- 通过率: XX%

### 问题汇总
| 接口名称 | 问题描述 | 严重程度 | 状态 |
|---------|---------|---------|------|
| 接口1   | 问题描述 | 高/中/低 | 待修复/已修复 |

### 性能指标
- 平均响应时间: XXXms
- 95%响应时间: XXXms  
- 最大并发数: XXX

### 测试结论
基于测试结果给出接口质量评估和上线建议。
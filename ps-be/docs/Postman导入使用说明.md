# Postman导入使用说明

## 📦 文件说明

本文件夹包含业务中台开放API接口的Postman导入文件，方便第三方应用开发者快速测试API接口。

## 📥 导入步骤

### 1. 打开Postman
启动Postman应用程序（如未安装，请访问 https://www.postman.com/downloads/ 下载）

### 2. 导入Collection
1. 点击左上角 **Import** 按钮
2. 选择 **File** 标签
3. 点击 **Choose Files**
4. 选择文件：`开放API接口-Postman导入文件.json`
5. 点击 **Import** 完成导入

### 3. 导入成功
导入成功后，您将在左侧看到一个名为 **"业务中台开放API接口"** 的Collection，包含以下6个接口：

```
用户信息接口/
├── 查询单个用户信息 (GET)
├── 分页查询用户列表 (GET)
├── 搜索用户 (POST)
├── 修改用户信息 (PUT) ⚠️
├── 重置用户密码 (PUT) ⚠️
└── 同步用户到SSO (POST) ⚠️
```

## ⚙️ 环境变量配置

导入后，Collection已自动配置以下环境变量：

| 变量名 | 默认值 | 说明 | 是否需要修改 |
|--------|--------|------|-------------|
| BASE_URL | http://localhost:10801/ps-be/open-api/v1 | API基础路径 | 生产环境需修改 |
| API_KEY | b4a4b6a002b64502b2cc715a6ddec8cc | API密钥 | **必须修改**为实际密钥 |

### 修改环境变量的方法

#### 方法1：在Collection级别修改（推荐）
1. 右键点击 **"业务中台开放API接口"** Collection
2. 选择 **Edit**
3. 切换到 **Variables** 标签
4. 修改 `BASE_URL` 和 `API_KEY` 的值
5. 点击 **Save**

#### 方法2：创建Environment（适合多环境切换）
1. 点击右上角齿轮图标 ⚙️
2. 点击 **Add** 创建新环境
3. 环境名称：例如 "开发环境" 或 "生产环境"
4. 添加变量：
   - Variable: `BASE_URL`, Value: `你的API地址`
   - Variable: `API_KEY`, Value: `你的API密钥`
5. 点击 **Add** 保存
6. 在右上角环境下拉框中选择刚创建的环境

## 🧪 测试接口

### 快速测试流程

#### 1. 查询单个用户信息
1. 展开 **用户信息接口** 文件夹
2. 点击 **查询单个用户信息**
3. 修改URL中的 `personId` 参数为实际的人员ID
4. 点击 **Send** 发送请求
5. 查看响应结果

#### 2. 修改用户信息（敏感操作）
1. 点击 **修改用户信息**
2. 修改URL中的 `personId` 参数
3. 修改Body中的参数（personName、phone、email、tel）
4. 点击 **Send** 发送请求
5. 验证修改是否成功

#### 3. 重置用户密码（敏感操作）
1. 点击 **重置用户密码**
2. 修改URL中的 `personId` 参数
3. 修改Body中的 `newPassword`（需符合密码强度要求）
4. 点击 **Send** 发送请求
5. 尝试使用新密码登录验证

#### 4. 同步用户到SSO（异步操作）
1. 点击 **同步用户到SSO**
2. 修改URL中的 `personId` 参数
3. 点击 **Send** 发送请求
4. 接口立即返回，实际同步在后台执行
5. 查看后台日志或Keycloak管理控制台验证同步结果

## 📋 接口说明

### 查询类接口（只读）
- ✅ **查询单个用户信息** - 安全，随时可测试
- ✅ **分页查询用户列表** - 安全，随时可测试
- ✅ **搜索用户** - 安全，随时可测试

### 管理类接口（写操作，需谨慎）
- ⚠️ **修改用户信息** - 会修改数据库和Keycloak，谨慎使用
- ⚠️ **重置用户密码** - 会修改密码并同步到Keycloak多凭据，谨慎使用
- ⚠️ **同步用户到SSO** - 会创建或更新Keycloak用户，异步操作

## 🔐 认证说明

所有接口都使用 **API Key认证**：
- 认证方式：在请求头中添加 `Authorization` 字段
- 值：您的API密钥（从第三方应用管理页面获取）
- Collection已自动配置，使用环境变量 `{{API_KEY}}`

## 📝 常见问题

### 1. 401错误：未授权访问
**原因**：API Key无效或缺失  
**解决**：检查环境变量中的 `API_KEY` 是否正确

### 2. 403错误：禁止访问
**原因**：
- 应用未被授权该接口
- IP地址不在白名单中
- 应用已被禁用或过期

**解决**：
- 在管理后台为应用授权相应接口
- 检查IP白名单配置
- 确认应用状态和有效期

### 3. 404错误：资源不存在
**原因**：
- URL路径错误
- personId不存在

**解决**：
- 检查 `BASE_URL` 配置是否正确
- 确认personId是否有效

### 4. 密码重置失败：密码不符合安全等级要求
**原因**：密码强度不足  
**解决**：密码需满足以下要求：
- 长度至少8位
- 包含大写字母、小写字母、数字
- 可包含特殊字符

### 5. SSO同步后看不到结果
**原因**：SSO同步是异步操作  
**解决**：
- 接口返回成功只表示任务已提交
- 查看后台日志确认同步进度
- 登录Keycloak管理控制台查看用户是否创建/更新

## 🔍 调试技巧

### 1. 查看请求详情
- 在Postman中点击 **Code** 按钮，可以查看等效的curl命令
- 有助于在其他工具中复现请求

### 2. 保存测试用例
- 发送请求后，点击 **Save Response** 保存响应示例
- 便于对比正常响应和异常响应

### 3. 使用Pre-request Script
- 可以在Collection级别添加Pre-request脚本
- 例如：自动生成时间戳、签名等

### 4. 使用Tests进行自动化测试
```javascript
// 示例：验证响应状态码
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

// 示例：验证响应数据
pm.test("Response has success flag", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData.success).to.eql(true);
});
```

## 📚 相关文档

- **完整API文档**：`开放API接口文档.md`
- **第三方应用接入文档**：`第三方应用接入文档.md`
- **快速开始指南**：`API接口管理-快速开始.md`

## 💡 最佳实践

1. **使用环境变量**：不要在请求中硬编码API Key和URL
2. **妥善保管密钥**：不要将包含真实API Key的Postman文件提交到版本控制
3. **谨慎测试写操作**：修改、删除类接口最好在测试环境测试
4. **保存测试集合**：将常用的测试用例保存为Collection Runner
5. **记录测试结果**：使用Postman的Notes功能记录测试发现

## ⚠️ 安全提醒

- 🔒 API Key具有完整的接口访问权限，请妥善保管
- 🔒 不要在公共场合分享包含真实API Key的Postman文件
- 🔒 定期更换API Key以提高安全性
- 🔒 只向可信的第三方应用授权敏感接口（修改用户信息、重置密码、SSO同步）
- 🔒 在生产环境使用前，请先在测试环境充分测试

## 📞 技术支持

如有疑问或需要技术支持，请联系：
- **技术支持邮箱**: support@example.com
- **文档反馈邮箱**: docs@example.com

---

**最后更新时间**: 2025-12-16  
**文档版本**: 1.0.0

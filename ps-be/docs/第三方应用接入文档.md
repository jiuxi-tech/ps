# API接口管理功能 - 第三方应用接入文档

## 1. 概述

本文档介绍如何将第三方应用接入中台系统，获取API访问权限，以及如何调用开放API接口。

## 2. 接入流程

### 2.1 申请应用账号

1. 联系系统管理员，申请创建第三方应用
2. 提供以下信息:
   - 应用名称
   - 应用编码（唯一标识）
   - 应用描述
   - IP白名单（可选，多个IP用逗号分隔）
   - 过期时间（可选，留空表示永不过期）

### 2.2 获取API密钥

系统管理员创建应用后，会提供以下信息（**请妥善保管，密钥仅显示一次**）：

- **API Key**: 应用的唯一标识，用于API调用时的身份识别
- **API Secret**: 应用密钥，用于生成访问令牌

示例：
```
API Key: 550e8400-e29b-41d4-a716-446655440000
API Secret: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
```

### 2.3 申请API权限

联系系统管理员，申请需要访问的API接口权限。可用的API清单如下：

| API名称 | HTTP方法 | 路径 | 描述 |
|---------|----------|------|------|
| 根据ID查询用户 | GET | /open-api/v1/users/{personId} | 查询单个用户信息（脱敏） |
| 分页查询用户列表 | GET | /open-api/v1/users | 查询用户列表（支持部门筛选） |

更多API接口正在开发中...

## 3. API调用说明

### 3.1 认证方式

所有开放API调用都需要在HTTP请求头中携带API Key：

```
Authorization: Bearer {your-api-key}
```

### 3.2 请求示例

#### 3.2.1 查询单个用户信息

**请求：**
```bash
curl -X GET "http://your-domain:8082/open-api/v1/users/2024112900000001" \
  -H "Authorization: Bearer 550e8400-e29b-41d4-a716-446655440000"
```

**响应：**
```json
{
  "code": 1,
  "message": "success",
  "data": {
    "personId": "2024112900000001",
    "personName": "张*",
    "personNo": "E****01",
    "phone": "138****5678",
    "email": "z***n@example.com",
    "gender": "1",
    "deptId": "dept001",
    "deptName": "研发部",
    "status": 1
  }
}
```

#### 3.2.2 分页查询用户列表

**请求：**
```bash
curl -X GET "http://your-domain:8082/open-api/v1/users?deptId=dept001&page=1&size=20" \
  -H "Authorization: Bearer 550e8400-e29b-41d4-a716-446655440000"
```

**响应：**
```json
{
  "code": 1,
  "message": "success",
  "data": {
    "records": [
      {
        "personId": "2024112900000001",
        "personName": "张*",
        "personNo": "E****01",
        "phone": "138****5678",
        "email": "z***n@example.com",
        "gender": "1",
        "deptId": "dept001",
        "deptName": "研发部",
        "status": 1
      }
    ],
    "total": 100,
    "size": 20,
    "current": 1,
    "pages": 5
  }
}
```

### 3.3 数据脱敏规则

为保护用户隐私，开放API返回的数据已进行脱敏处理：

| 字段 | 脱敏规则 | 示例 |
|------|----------|------|
| 姓名 | 保留姓氏，其他替换为* | 张三 → 张* |
| 工号 | 保留首尾各2位，中间替换为**** | E001234501 → E0****01 |
| 手机号 | 保留前3后4位，中间替换为**** | 13812345678 → 138****5678 |
| 邮箱 | 用户名保留首尾，域名完整 | zhangsan@example.com → z***n@example.com |
| 身份证 | 保留前6后4位，中间替换为**** | 330102199001011234 → 330102********1234 |

## 4. 错误码说明

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 401 | API Key无效或缺失 | 检查请求头中的Authorization是否正确 |
| 403 | 应用已禁用 | 联系管理员启用应用 |
| 403 | IP地址不在白名单 | 联系管理员添加IP到白名单 |
| 403 | 应用已过期 | 联系管理员延长过期时间 |
| 403 | 无权限访问该API | 联系管理员授予该API的访问权限 |
| 404 | 资源不存在 | 检查请求路径和参数是否正确 |
| 500 | 服务器内部错误 | 联系技术支持 |

## 5. 开发示例

### 5.1 Java示例

```java
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.net.URI;

public class OpenApiClient {
    
    private static final String API_KEY = "your-api-key";
    private static final String BASE_URL = "http://your-domain:8082";
    
    public static void main(String[] args) throws Exception {
        HttpClient client = HttpClient.newHttpClient();
        
        // 查询用户信息
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(BASE_URL + "/open-api/v1/users/2024112900000001"))
            .header("Authorization", "Bearer " + API_KEY)
            .GET()
            .build();
        
        HttpResponse<String> response = client.send(request, 
            HttpResponse.BodyHandlers.ofString());
        
        System.out.println("Response: " + response.body());
    }
}
```

### 5.2 Python示例

```python
import requests

API_KEY = "your-api-key"
BASE_URL = "http://your-domain:8082"

# 查询用户信息
headers = {
    "Authorization": f"Bearer {API_KEY}"
}

response = requests.get(
    f"{BASE_URL}/open-api/v1/users/2024112900000001",
    headers=headers
)

print(response.json())
```

### 5.3 JavaScript示例

```javascript
const API_KEY = "your-api-key";
const BASE_URL = "http://your-domain:8082";

// 查询用户信息
fetch(`${BASE_URL}/open-api/v1/users/2024112900000001`, {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${API_KEY}`
  }
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));
```

## 6. 注意事项

1. **密钥安全**：
   - API Secret仅在创建应用时显示一次，请务必妥善保管
   - 不要将API Key和Secret提交到代码仓库
   - 建议使用环境变量或配置文件管理密钥

2. **IP白名单**：
   - 建议配置IP白名单，只允许指定IP访问
   - 生产环境务必配置白名单，提高安全性

3. **过期时间**：
   - 建议设置合理的过期时间
   - 过期前请联系管理员续期

4. **请求频率**：
   - 建议控制API调用频率，避免对系统造成压力
   - 如需高频调用，请提前联系技术支持

5. **数据使用**：
   - 返回的脱敏数据仅供展示使用
   - 禁止尝试逆向还原脱敏数据
   - 禁止将获取的数据用于非授权用途

## 7. 技术支持

如有问题，请联系：
- 技术支持邮箱: support@example.com
- 技术支持电话: 400-xxx-xxxx

---

**文档版本**: v1.0  
**最后更新**: 2024-11-30

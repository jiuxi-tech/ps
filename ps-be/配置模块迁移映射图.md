# 配置模块迁移映射图

## 迁移路径规划

```
当前结构                                           目标结构
├── mvc/                                        ├── shared/config/web/
│   ├── autoconfig/                            │   ├── WebAutoConfiguration.java           [保留原位置]
│   │   ├── MvcAutoConfiguration.java          │   ├── WebConfigurationProperties.java     [保留原位置]
│   │   └── MvcConfigurationProperties.java    │   ├── WebMvcConfigurer.java              [迁移]
│   └── core/config/                           │   ├── CorsConfiguration.java             [迁移]
│       ├── MvcWebMvcConfigurer.java           │   └── interceptor/                       [迁移]
│       └── CorsConfigurer.java                │       ├── TenantInterceptor.java
│                                              │       └── TokenInterceptor.java
├── mybatis/                                   │
│   ├── autoconfig/                            ├── shared/config/database/
│   │   ├── TopinfoMybatisAutoConfiguration    │   ├── MybatisPlusConfiguration.java      [迁移核心逻辑]
│   │   └── TopinfoDynamicSql...Configuration  │   ├── DataSourceConfiguration.java       [迁移]
│   ├── bean/DataSourceConfig.java             │   └── DynamicDataSourceConfig.java      [迁移]
│   ├── core/dynamic/                          │
│   └── util/PageUtils.java                    ├── shared/infrastructure/persistence/
│                                              │   ├── dynamic/                           [迁移]
├── config/                                    │   │   ├── DynamicDataSource.java
│   ├── ConfigChangeEvent.java                 │   │   ├── DynamicDataSourceAspect.java
│   ├── ConfigChangeListener.java              │   │   └── DynamicDataSourceContextHolder.java
│   └── IpAccessConfigCache.java               │   ├── generator/                         [迁移]
│                                              │   │   ├── CustomIdGenerator.java
├── common/config/                             │   │   └── SnowflakeIdUtil.java
│   ├── RedisConfig.java                       │   └── util/                             [迁移]
│   ├── SecurityConfig.java                    │       ├── PageUtils.java
│   └── ValidationConfig.java                  │       └── Query.java
│                                              │
└── core/config/                               ├── shared/config/
    └── CacheConfig.java                       │   ├── events/                           [迁移]
                                              │   │   ├── ConfigChangeEvent.java
                                              │   │   └── ConfigChangeListener.java
                                              │   └── cache/                            [迁移]
                                              │       ├── IpAccessConfigCache.java
                                              │       ├── RedisConfiguration.java
                                              │       └── CacheConfiguration.java
                                              │
                                              └── shared/config/properties/             [新增]
                                                  └── ValidationConfiguration.java     [迁移]
```

## 详细迁移计划

### 阶段1: Web配置迁移 (风险: 低)
```bash
# 创建目标目录
mkdir -p shared/config/web/interceptor/

# 迁移配置类
mvc/core/config/MvcWebMvcConfigurer.java      → shared/config/web/WebMvcConfigurer.java
mvc/core/config/CorsConfigurer.java          → shared/config/web/CorsConfiguration.java

# 迁移拦截器
mvc/core/interceptor/TenantInterceptor.java   → shared/config/web/interceptor/
mvc/core/interceptor/TokenInterceptor.java    → shared/config/web/interceptor/
```

### 阶段2: 通用配置迁移 (风险: 低)  
```bash
# 创建目标目录
mkdir -p shared/config/events/
mkdir -p shared/config/cache/

# 迁移事件相关
config/ConfigChangeEvent.java                → shared/config/events/
config/ConfigChangeListener.java             → shared/config/events/

# 迁移缓存相关
config/IpAccessConfigCache.java             → shared/config/cache/
common/config/RedisConfig.java              → shared/config/cache/RedisConfiguration.java
core/config/CacheConfig.java                → shared/config/cache/CacheConfiguration.java
```

### 阶段3: 数据库配置迁移 (风险: 中)
```bash  
# 创建目标目录
mkdir -p shared/config/database/
mkdir -p shared/infrastructure/persistence/dynamic/
mkdir -p shared/infrastructure/persistence/generator/
mkdir -p shared/infrastructure/persistence/util/

# 迁移配置类 (提取核心逻辑)
mybatis/bean/DataSourceConfig.java           → shared/config/database/DataSourceConfiguration.java

# 迁移基础设施组件
mybatis/core/dynamic/*                       → shared/infrastructure/persistence/dynamic/
mybatis/core/idgenerator/*                   → shared/infrastructure/persistence/generator/  
mybatis/util/*                               → shared/infrastructure/persistence/util/
```

## 依赖关系分析

### 高依赖风险组件
- `TopinfoMybatisAutoConfiguration.java` - 被Spring Boot扫描机制依赖
- `DynamicDataSource*` - 被多个业务模块引用
- 各种`*Interceptor` - 被MVC配置引用

### 安全迁移策略
1. **保留AutoConfiguration类在原位置** - 避免破坏Spring Boot自动装配
2. **渐进式迁移** - 先迁移独立组件，后迁移核心组件  
3. **双向兼容** - 保留原有引用路径，添加新路径
4. **充分测试** - 每个阶段完成后进行编译和功能测试

## 验收标准
- [ ] 所有迁移路径明确且可执行
- [ ] 识别出高风险依赖组件
- [ ] 制定了渐进式迁移策略  
- [ ] 明确了需要保留在原位置的组件
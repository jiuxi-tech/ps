############################################################
#############  生产环境配置文件（外挂单文件）
#############  Production Environment Configuration
#############  
#############  使用方式：
#############  java -jar ps-be.jar --spring.profiles.active=prod
#############  
#############  说明：此文件基于dev配置创建，所有配置值均为实际值
############################################################

############################################################
#############  服务器配置
############################################################
server:
  port: 8082
  servlet:
    context-path: /ps-be
  tomcat:
    uri-encoding: UTF-8
    max-threads: 1000
    max-http-form-post-size: 10MB
  max-http-header-size: 10MB

############################################################
#############  Spring Boot 核心配置
############################################################
spring:
  application:
    name: ps-be
    id: ps-be
  
  main:
    allow-bean-definition-overriding: true
    allow-circular-references: true
  
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 100MB
  
  resources:
    static-locations: classpath:/static/,classpath:/views/
  
  mvc:
    static-path-pattern: /static/**
  
  messages:
    basename: i18n/messages,i18n/validation
    encoding: UTF-8
    cache-duration: 3600
    fallback-to-system-locale: true

############################################################
#############  数据源配置
############################################################
  datasource:
    driver-class-name: org.mariadb.jdbc.Driver
    url: jdbc:mariadb://alilaoba.cn:13307/ps-bmp?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    username: root
    password: $D8BZ8Qmav
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 500
      max-wait: 60000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        reset-enable: false
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"

############################################################
#############  Redis 配置
############################################################
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
    timeout: 3000ms
    jedis:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0

############################################################
#############  Redisson 配置
############################################################
  redisson:
    config: classpath:redis/redisson-single.yml

############################################################
#############  缓存配置
############################################################
  cache:
    type: ehcache
    ehcache:
      config: classpath:config/cache/ehcache-dev.xml

############################################################
#############  邮件配置
############################################################
  mail:
    host: smtp.163.com
    port: 465
    username: 18069853753@163.com
    password: WQbFDS7fdK92fKcU
    protocol: smtp
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
            fallback: false

############################################################
#############  DevTools 配置（生产环境禁用）
############################################################
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false

############################################################
#############  日志配置
############################################################
logging:
  config: classpath:config/log/logback-spring.xml
  level:
    root: INFO
    com.jiuxi.admin: INFO
    com.jiuxi.shared: INFO
    com.jiuxi.module: INFO
    org.mybatis: INFO
    com.baomidou.mybatisplus: INFO
    com.alibaba.druid: INFO
    org.apache.ibatis: INFO
    org.springframework.jdbc: INFO
    org.springframework.jdbc.core: INFO
    org.springframework.transaction: INFO
    org.springframework.jdbc.datasource: INFO
    com.jiuxi.monitor: INFO

############################################################
#############  Actuator 监控配置
############################################################
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,conditions
  endpoint:
    health:
      show-details: when_authorized

############################################################
#############  应用信息配置
############################################################
info:
  app:
    name: ps-be
    description: PS-BMP Backend System (Production)
    version: 2.2.2-SNAPSHOT
    encoding: UTF-8

############################################################
#############  自定义应用配置
############################################################
app:
  info:
    name: ps-be
    version: 2.2.2-SNAPSHOT
    description: PS-BMP Backend System (Production)
    encoding: UTF-8
    author: System
    contact: admin@jiuxi.com
  
  upload:
    max-file-size: 50MB
    max-request-size: 100MB
    allowed-types:
      - image/jpeg
      - image/png
      - image/gif
      - image/bmp
      - application/pdf
      - application/msword
      - application/vnd.openxmlformats-officedocument.wordprocessingml.document
      - application/vnd.ms-excel
      - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
    upload-dir: /upload
  
  i18n:
    basename:
      - i18n/messages
      - i18n/validation
    encoding: UTF-8
    cache-duration: 3600
    fallback-to-system-locale: true
    default-locale: zh_CN
  
  monitor:
    enabled: true
    server-url: http://192.168.0.139:8082/ps-be
    client-id: ps-bmp-backend-prod
    system-desc: PS-BMP后端系统（生产环境）
    connection-timeout: 3000
    read-timeout: 5000
  
  database:
    datasource:
      driver-class-name: org.mariadb.jdbc.Driver
      url: jdbc:mariadb://alilaoba.cn:13307/ps-bmp?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
      username: root
      password: $D8BZ8Qmav
      validation-query: SELECT 1
      connection-timeout: 30000
      max-lifetime: 1800000
    pool:
      initial-size: 5
      min-idle: 5
      max-active: 500
      max-wait: 60000
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
    mybatis:
      datacenter-id: 0
      machine-id: 0
      tenant: false
      ignore-tenant-tables:
        - test
      page-limit: 1000
      page-helper-enabled: true
      performance-interceptor-enabled: false
      slow-sql-threshold: 3000
    monitor:
      enabled: true
      url-pattern: /druid/*
      reset-enable: false
      web-stat-filter:
        enabled: true
        url-pattern: /*
        exclusions: "*.js,*.gif,*.jpg,*.bmp,*.png,*.css,*.ico,/druid/*"
  
  cache:
    redis:
      host: localhost
      port: 6379
      password: ""
      database: 0
      timeout: 3000
      pool:
        max-active: 8
        max-wait: -1
        max-idle: 8
        min-idle: 0
      cluster:
        enabled: false
        nodes: []
        max-redirects: 3
      sentinel:
        enabled: false
        nodes: []
    local:
      type: ehcache
      ehcache-config: classpath:config/cache/ehcache-dev.xml
      caffeine:
        maximum-size: 1000
        expire-after-write: 3600
        expire-after-access: 1800
        initial-capacity: 100
    distributed-lock:
      enabled: true
      wait-time: 3000
      lease-time: 30000
      key-prefix: "lock:"
      watchdog: true
    strategy:
      default-ttl: 1800
      short-ttl: 300
      long-ttl: 86400
      enable-statistics: true
      refresh-strategy: async
      warmup:
        enabled: false
        delay: 30
        data-sources: []
  
  security:
    basic:
      enabled: true
      password-encryption: true
      session-timeout: 3600
      csrf-enabled: true
      xss-enabled: true
    authentication:
      exclude-paths:
        - /static/**
        - /sys/captcha/**
        - /sys/file/preview-pdf
        - /sys/person/account-findpwd
        - /sys/person/check-vcode
        - /sys/**
        - /sys/person/getUserInfo
        - /**
        - /api/**
        - /app/sys/captcha/verification-image
        - /platform/captcha/get-slider-captcha
        - /sys/file/download
        - /app/sys/file/download
        - /app/**
        - /platform/**
        - /app/sys/file/upload
        - /app/trainoffline/**
        - /gdemergencyvehicle/sgddcreservation/**
        - /common/clientlogin/getPhoneByLoginName
        - /common/clientlogin/sendMsg
        - /common/clientlogin/checkPhoneCode
        - /taskcheck/siccheckpoint/**
        - /taskcheck/sicchecktask/**
        - /druid/**
        - /actuator/**
      max-retry-attempts: 3
      lockout-duration: 30
      captcha-enabled: true
      captcha-expiry: 300
      password-policy:
        length:
          min: 6
          max: 20
        complexity:
          enabled: true
          require-uppercase: false
          require-lowercase: true
          require-digit: true
          require-special: false
          allowed-special-chars: "@$!%*?&"
          custom-regex: ""
        weak-password:
          enabled: true
          blacklist:
            - "123456"
            - "password"
            - "admin123"
            - "12345678"
            - "qwerty"
          check-username-similarity: true
          min-strength-level: 1
      account-lockout:
        enabled: true
        max-attempts: 10
        lockout-duration: 10
        max-total-attempts: 30
        reset-attempts-after: 60
        lockout-type: "temporary"
    keycloak:
      server-url: http://localhost:18080
      realm: ps-realm
      sso:
        enabled: true
        client-id: ps-be
        client-secret: xMXvDGzby4Z48szob7i2fuZlZy5Wlqrh
        redirect:
          success-url: http://localhost:10801/#/sso/login
          error-url: http://localhost:10801/#/login
          logout-url: http://localhost:10801/#/logout
        user-header:
          user-id-header: X-User-Id
          username-header: X-Username
          email-header: X-User-Email
          name-header: X-User-Name
          roles-header: X-User-Roles
          permissions-header: X-User-Permissions
      admin:
        client-id: admin-cli
        username: admin
        password: admin123
        connection-timeout: 5000
        read-timeout: 10000
    jwt:
      verify-expiration: true
      verify-issuer: true
      verify-audience: false
      cache-ttl: 300
      secret: ps-be-jwt-secret-key-2024
      expiration: 3600
      refresh-expiration: 7200
      token-header: Authorization
      token-prefix: "Bearer "
    file-service:
      mode: local
      local:
        base-dir: D:\upload\jdfs
        url-prefix: /files
        max-file-size: 100MB
        allowed-extensions:
          - jpg
          - jpeg
          - png
          - gif
          - bmp
          - pdf
          - doc
          - docx
          - xls
          - xlsx
          - ppt
          - pptx
          - txt
          - zip
          - rar
      remote:
        server-url: http://localhost:8080
        bucket-name: ps-files
    encryption:
      password-algorithm: BCrypt
      bcrypt-strength: 10
      aes-key: ps-be-aes-key-2024
      rsa-key-length: 2048
      sm:
        enabled: false

############################################################
#############  MyBatis 配置（向后兼容）
############################################################
topinfo:
  mybatis:
    datacenterId: 0
    machineId: 0
    datasource-config:
      url: jdbc:mariadb://alilaoba.cn:13307/ps-bmp?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
      username: root
      password: $D8BZ8Qmav
      minIdle: 5
      maxActive: 500
      validationQuery: SELECT 1
    tenant: false
    ignore-tenant-tables:
      - test
  
  security:
    enable: true
    password-encryption: true
    authentication:
      excludePaths:
        - /static/**
        - /sys/captcha/**
        - /sys/file/preview-pdf
        - /sys/person/account-findpwd
        - /sys/person/check-vcode
        - /sys/**
        - /sys/person/getUserInfo
        - /**
        - /api/**
        - /app/sys/captcha/verification-image
        - /platform/captcha/get-slider-captcha
        - /sys/file/download
        - /app/sys/file/download
        - /app/**
        - /platform/**
        - /app/sys/file/upload
        - /app/trainoffline/**
        - /gdemergencyvehicle/sgddcreservation/**
        - /common/clientlogin/getPhoneByLoginName
        - /common/clientlogin/sendMsg
        - /common/clientlogin/checkPhoneCode
        - /taskcheck/siccheckpoint/**
        - /taskcheck/sicchecktask/**
        - /druid/**
        - /actuator/**
  
  jdfs:
    client:
      model: local
      local:
        logical-disk:
          D1:
            dir: D:\upload\jdfs
            status: rw

############################################################
#############  Keycloak 配置（向后兼容）
############################################################
keycloak:
  server-url: http://localhost:18080
  realm: ps-realm
  sso:
    enabled: true
    server-url: http://localhost:18080
    realm: ps-realm
    client-id: ps-be
    client-secret: xMXvDGzby4Z48szob7i2fuZlZy5Wlqrh
    redirect:
      success-url: http://localhost:10801/#/sso/login
      error-url: http://localhost:10801/#/login
    jwt:
      verify-expiration: true
      verify-issuer: true
      verify-audience: false
      cache-ttl: 300
    user-header:
      user-id-header: X-User-Id
      username-header: X-Username
      email-header: X-User-Email
      name-header: X-User-Name
      roles-header: X-User-Roles
      permissions-header: X-User-Permissions
  admin:
    client-id: admin-cli
    username: admin
    password: admin123

############################################################
#############  监控插件配置
############################################################
jiuxi:
  platform:
    plugin:
      monitor:
        server-url: http://192.168.0.139:8082/ps-be
        system-desc: PS-BMP后端系统（生产环境）
        client-id: ps-bmp-backend-prod
        connection-timeout: 3000
        read-timeout: 5000
        mail-config:
          user: 18069853753@163.com
          password: WQbFDS7fdK92fKcU
          smtp: smtp.163.com
          port: 465

############################################################
#############  调试配置
############################################################
debug: false

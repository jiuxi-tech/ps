# application-prod.yml ä½¿ç”¨è¯´æ˜

## ğŸ“„ æ–‡ä»¶è¯´æ˜

`application-prod.yml` æ˜¯åŸºäºå¼€å‘ç¯å¢ƒé…ç½®åˆ›å»ºçš„ç”Ÿäº§ç¯å¢ƒå•æ–‡ä»¶é…ç½®ã€‚

### ç‰¹ç‚¹

1. **å•æ–‡ä»¶é…ç½®** - æ‰€æœ‰é…ç½®é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶
2. **æ— å˜é‡å¼•ç”¨** - æ‰€æœ‰å€¼éƒ½æ˜¯å®é™…å€¼ï¼Œä¸ä½¿ç”¨ `${...}` å ä½ç¬¦
3. **æ‰å¹³åŒ–é…ç½®** - å‡å°‘åµŒå¥—å±‚çº§ï¼Œé…ç½®æ›´ç›´è§‚
4. **ç›´æ¥ä½¿ç”¨** - åŸºäºdevç¯å¢ƒçš„å®é™…é…ç½®å€¼

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. JAR åŒ…å†…ç½®é…ç½®ï¼ˆæ¨èï¼‰

é…ç½®æ–‡ä»¶å·²æ”¾åœ¨ `src/main/resources/application-prod.yml`ï¼Œæ‰“åŒ…åä¼šåŒ…å«åœ¨ JAR ä¸­ã€‚

**å¯åŠ¨å‘½ä»¤**ï¼š

```bash
java -jar ps-be.jar --spring.profiles.active=prod
```

### 2. å¤–æŒ‚é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å¤–æŒ‚é…ç½®ï¼Œå¯ä»¥å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ° JAR åŒ…åŒçº§ç›®å½•ï¼š

```bash
# ç›®å½•ç»“æ„
/opt/ps/
â”œâ”€â”€ ps-be.jar
â””â”€â”€ application-prod.yml

# å¯åŠ¨å‘½ä»¤
java -jar ps-be.jar --spring.profiles.active=prod
```

Spring Boot ä¼šè‡ªåŠ¨ä¼˜å…ˆåŠ è½½å¤–éƒ¨çš„ `application-prod.yml`ã€‚

### 3. æŒ‡å®šå¤–éƒ¨é…ç½®ç›®å½•

```bash
# ç›®å½•ç»“æ„
/opt/ps/
â”œâ”€â”€ ps-be.jar
â””â”€â”€ config/
    â””â”€â”€ application-prod.yml

# å¯åŠ¨å‘½ä»¤
java -jar ps-be-1.0.0.jar --spring.profiles.active=prod --spring.config.location=classpath:/,file:./config/
```

## ğŸ“ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é¡¹

| é…ç½®åˆ†ç±» | è¯´æ˜ | å½“å‰å€¼ï¼ˆåŸºäºdevï¼‰ |
|---------|------|------------------|
| æœåŠ¡å™¨ç«¯å£ | Tomcat ç›‘å¬ç«¯å£ | 8082 |
| æ•°æ®åº“ | MariaDB è¿æ¥ | alilaoba.cn:13307 |
| Redis | ç¼“å­˜æœåŠ¡ | localhost:6379 |
| Keycloak | SSO è®¤è¯ | localhost:18080 |
| é‚®ä»¶æœåŠ¡ | SMTP 163é‚®ç®± | 18069853753@163.com |
| æ–‡ä»¶å­˜å‚¨ | æœ¬åœ°å­˜å‚¨è·¯å¾„ | D:\upload\jdfs |
| ç›‘æ§æœåŠ¡ | ç›‘æ§åœ°å€ | 192.168.0.139:8082 |

### å…³é”®å·®å¼‚ï¼ˆç›¸æ¯”devé…ç½®ï¼‰

1. **æ—¥å¿—çº§åˆ«**ï¼šä» DEBUG æ”¹ä¸º INFOï¼Œå‡å°‘æ—¥å¿—è¾“å‡º
2. **DevTools**ï¼šç¦ç”¨çƒ­é‡è½½åŠŸèƒ½
3. **æè¿°ä¿¡æ¯**ï¼šæ ‡è®°ä¸º"ç”Ÿäº§ç¯å¢ƒ"
4. **å®¢æˆ·ç«¯ID**ï¼šä» `ps-bmp-backend-dev` æ”¹ä¸º `ps-bmp-backend-prod`

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç”Ÿäº§éƒ¨ç½²å‰å¿…é¡»ä¿®æ”¹

1. **æ•°æ®åº“é…ç½®**ï¼ˆå¦‚æœç”Ÿäº§ç¯å¢ƒä¸åŒï¼‰ï¼š
   ```yaml
   datasource:
     url: jdbc:mariadb://ç”Ÿäº§æ•°æ®åº“åœ°å€:3306/ps-bmp
     username: ç”Ÿäº§æ•°æ®åº“ç”¨æˆ·
     password: ç”Ÿäº§æ•°æ®åº“å¯†ç 
   ```

2. **Redis é…ç½®**ï¼ˆå¦‚æœç”Ÿäº§ç¯å¢ƒä¸åŒï¼‰ï¼š
   ```yaml
   redis:
     host: ç”Ÿäº§Redisåœ°å€
     port: 6379
     password: ç”Ÿäº§Rediså¯†ç 
   ```

3. **Keycloak é…ç½®**ï¼ˆå¦‚æœç”Ÿäº§ç¯å¢ƒä¸åŒï¼‰ï¼š
   ```yaml
   keycloak:
     server-url: https://ç”Ÿäº§SSOåœ°å€
     sso:
       client-secret: ç”Ÿäº§ç¯å¢ƒå®¢æˆ·ç«¯å¯†é’¥
       redirect:
         success-url: https://ç”Ÿäº§å‰ç«¯åœ°å€/#/sso/login
   ```

4. **æ–‡ä»¶å­˜å‚¨è·¯å¾„**ï¼ˆLinux ç”Ÿäº§ç¯å¢ƒï¼‰ï¼š
   ```yaml
   file-service:
     local:
       base-dir: /opt/ps/upload/jdfs
   ```

5. **é‚®ä»¶é…ç½®**ï¼ˆå¦‚æœä½¿ç”¨ä¸åŒé‚®ç®±ï¼‰ï¼š
   ```yaml
   mail:
     host: smtp.ç”Ÿäº§é‚®ç®±æœåŠ¡å™¨
     username: ç”Ÿäº§é‚®ç®±è´¦å·
     password: ç”Ÿäº§é‚®ç®±å¯†ç 
   ```

## ğŸ”§ å¿«é€Ÿä¿®æ”¹é…ç½®çš„æ–¹æ³•

### æ–¹æ³•1ï¼šä¿®æ”¹æºæ–‡ä»¶åé‡æ–°æ‰“åŒ…

1. ç¼–è¾‘ `src/main/resources/application-prod.yml`
2. æ‰§è¡Œ `mvn clean package` é‡æ–°æ‰“åŒ…
3. ä½¿ç”¨æ–°çš„ JAR åŒ…éƒ¨ç½²

### æ–¹æ³•2ï¼šä½¿ç”¨å¤–æŒ‚é…ç½®ï¼ˆæ¨èï¼‰

1. ä» JAR åŒ…ä¸­æå– `application-prod.yml`ï¼š
   ```bash
   jar xf ps-be.jar BOOT-INF/classes/application-prod.yml
   ```
   
2. ä¿®æ”¹é…ç½®æ–‡ä»¶

3. æ”¾åˆ° JAR åŒ…åŒçº§ç›®å½•æˆ– `config/` ç›®å½•

4. å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨å¤–éƒ¨é…ç½®æ–‡ä»¶

## ğŸ“Š é…ç½®æ–‡ä»¶ç»“æ„

```
application-prod.yml
â”œâ”€â”€ server                    # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ spring                    # Spring Boot é…ç½®
â”‚   â”œâ”€â”€ application          # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ datasource           # æ•°æ®æºé…ç½®
â”‚   â”œâ”€â”€ redis                # Redis é…ç½®
â”‚   â”œâ”€â”€ cache                # ç¼“å­˜é…ç½®
â”‚   â”œâ”€â”€ mail                 # é‚®ä»¶é…ç½®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ logging                   # æ—¥å¿—é…ç½®
â”œâ”€â”€ management               # Actuator ç›‘æ§
â”œâ”€â”€ app                      # è‡ªå®šä¹‰åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ info                 # åº”ç”¨ä¿¡æ¯
â”‚   â”œâ”€â”€ database             # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ cache                # ç¼“å­˜é…ç½®
â”‚   â””â”€â”€ security             # å®‰å…¨é…ç½®
â”œâ”€â”€ topinfo                  # å‘åå…¼å®¹é…ç½®
â”œâ”€â”€ keycloak                 # Keycloak SSO
â””â”€â”€ jiuxi                    # ç›‘æ§æ’ä»¶
```

## âœ… éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

å¯åŠ¨åº”ç”¨åï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

1. **æ—¥å¿—ä¸­æŸ¥çœ‹ profile**ï¼š
   ```
   The following profiles are active: prod
   ```

2. **æ£€æŸ¥ç«¯å£**ï¼š
   ```bash
   netstat -ano | findstr 8082
   ```

3. **è®¿é—®å¥åº·æ£€æŸ¥**ï¼š
   ```bash
   curl http://localhost:8082/ps-be/actuator/health
   ```

4. **æŸ¥çœ‹åº”ç”¨ä¿¡æ¯**ï¼š
   ```bash
   curl http://localhost:8082/ps-be/actuator/info
   ```

## ğŸ“ ç›¸å…³æ–‡æ¡£

- é…ç½®æ–‡ä»¶åˆ†æè®¾è®¡æ–‡æ¡£ï¼š`.qoder/quests/config-file-analysis.md`
- ç”Ÿäº§éƒ¨ç½²æŒ‡å—ï¼š`deploy/README-ç”Ÿäº§é…ç½®éƒ¨ç½²æŒ‡å—.md`

---

**åˆ›å»ºæ—¶é—´**ï¼š2024-12-02  
**é…ç½®æ¥æº**ï¼šåŸºäº dev ç¯å¢ƒé…ç½®  
**ç»´æŠ¤å»ºè®®**ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®åº”å•ç‹¬ç»´æŠ¤ï¼Œä¸è¦ç›´æ¥è¦†ç›–

# 字段重构补充修改总结

## 修改日期
2025-11-28

## 修改背景
在之前的字段重构基础上，进一步完善前端页面，确保所有页面都统一使用新字段 `ZWZJ`（职务职级）和 `ZHICHENG`（职称），完全隐藏旧的"职位"字段。

## 修改范围

### 1. 政府人员新增页面
**文件**：`ps-fe/@fb/admin-base/views\sys\person\org\add-basicinfo.vue`

**修改内容**：
- ✅ 隐藏"职位"（office）字段
- ✅ 保留"职务职级"（zwzj）字段
- ✅ 保留"职称"（zhicheng）字段
- ✅ 调整布局：人员编号和职务职级在同一行

**修改前**：
```vue
<fb-row>
    <fb-col span="12">
        <fb-form-item label="职位">
            <fb-input v-model="formData.office" placeholder="请输入职位"></fb-input>
        </fb-form-item>
    </fb-col>
    <fb-col span="12">
        <fb-form-item label="人员编号">
            <fb-input v-model="formData.personNo" placeholder="请输入人员编号"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>
<fb-row>
    <fb-col span="12">
        <fb-form-item label="职务职级">
            <fb-input v-model="formData.zwzj" placeholder="请输入职务职级"></fb-input>
        </fb-form-item>
    </fb-col>
    <fb-col span="12">
        <fb-form-item label="职称">
            <fb-input v-model="formData.zhicheng" placeholder="请输入职称"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>
```

**修改后**：
```vue
<!-- 职位字段已废弃，统一使用职务职级和职称 -->
<fb-row>
    <fb-col span="12">
        <fb-form-item label="人员编号">
            <fb-input v-model="formData.personNo" placeholder="请输入人员编号"></fb-input>
        </fb-form-item>
    </fb-col>
    <fb-col span="12">
        <fb-form-item label="职务职级">
            <fb-input v-model="formData.zwzj" placeholder="请输入职务职级"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>

<fb-row>
    <fb-col span="12">
        <fb-form-item label="职称">
            <fb-input v-model="formData.zhicheng" placeholder="请输入职称"></fb-input>
        </fb-form-item>
    </fb-col>
    <!-- 其他字段... -->
</fb-row>
```

### 2. 企业人员新增页面
**文件**：`ps-fe/@fb/admin-base/views\sys\person\ent\add-basicinfo.vue`

**修改内容**：
- ✅ 隐藏"职位"（office）字段
- ✅ 保留"职务职级"（zwzj）字段
- ✅ 保留"职称"（zhicheng）字段

**修改前**：
```vue
<fb-row>
    <fb-col span="12">
        <fb-form-item label="职位">
            <fb-input v-model="formData.office" placeholder="请输入职位"></fb-input>
        </fb-form-item>
    </fb-col>
    <fb-col span="12">
        <fb-form-item label="职务职级">
            <fb-input v-model="formData.zwzj" placeholder="请输入职务职级"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>
<fb-row>
    <fb-col span="12">
        <fb-form-item label="职称">
            <fb-input v-model="formData.zhicheng" placeholder="请输入职称"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>
```

**修改后**：
```vue
<!-- 职位字段已废弃，统一使用职务职级和职称 -->
<fb-row>
    <fb-col span="12">
        <fb-form-item label="职务职级">
            <fb-input v-model="formData.zwzj" placeholder="请输入职务职级"></fb-input>
        </fb-form-item>
    </fb-col>
    <fb-col span="12">
        <fb-form-item label="职称">
            <fb-input v-model="formData.zhicheng" placeholder="请输入职称"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>
```

### 3. 个人信息查看页面
**文件**：`ps-fe/@fb/admin-base/views\sys\user-home\profile.vue`

**修改内容**：
- ✅ 将"职位"改为"职务职级"和"职称"
- ✅ 使用新字段 `userInfo.zwzj` 和 `userInfo.zhicheng`

**修改前**：
```vue
<div class="info-row">
    <div class="info-label">
        <i class="iconfont jpx-icon-work-parameter label-icon"></i>
        <span>职位</span>
    </div>
    <div class="info-value">{{ userInfo.office || '-' }}</div>
</div>
```

**修改后**：
```vue
<div class="info-row">
    <div class="info-label">
        <i class="iconfont jpx-icon-work-parameter label-icon"></i>
        <span>职务职级</span>
    </div>
    <div class="info-value">{{ userInfo.zwzj || '-' }}</div>
</div>
<div class="info-row">
    <div class="info-label">
        <i class="iconfont jpx-icon-crown label-icon"></i>
        <span>职称</span>
    </div>
    <div class="info-value">{{ userInfo.zhicheng || '-' }}</div>
</div>
```

### 4. 个人信息编辑页面
**文件**：`ps-fe/@fb/admin-base/views\sys\user-home\profile_edit.vue`

**修改内容**：
- ✅ 将"职位"改为"职务职级"和"职称"
- ✅ 在 formData 中添加 `zwzj` 和 `zhicheng` 字段
- ✅ 在 initFormData 方法中映射新字段
- ✅ 在 saveProfile 方法中传递新字段到后端

**关键修改**：

**表单HTML**：
```vue
<fb-row>
    <fb-col span="12">
        <fb-form-item label="职务职级" prop="zwzj">
            <fb-input v-model="formData.zwzj" placeholder="请输入职务职级"></fb-input>
        </fb-form-item>
    </fb-col>
    <fb-col span="12">
        <fb-form-item label="职称" prop="zhicheng">
            <fb-input v-model="formData.zhicheng" placeholder="请输入职称"></fb-input>
        </fb-form-item>
    </fb-col>
</fb-row>
```

**formData 数据结构**：
```javascript
formData: {
    // ... 其他字段
    // office: '', // 已废弃
    // titleCode: '', // 已废弃
    zwzj: '', // 职务职级（新字段）
    zhicheng: '', // 职称（新字段）
    // ... 其他字段
}
```

**initFormData 方法**：
```javascript
this.formData = {
    // ... 其他字段
    // office: userInfo.office || '', // 已废弃
    // titleCode: userInfo.titleCode || '', // 已废弃
    zwzj: userInfo.zwzj || '', // 职务职级（新字段）
    zhicheng: userInfo.zhicheng || '', // 职称（新字段）
    // ... 其他字段
}
```

**saveProfile 方法（基本信息）**：
```javascript
const basicData = {
    // ... 其他字段
    // office: this.formData.office, // 已废弃
    zwzj: this.formData.zwzj, // 职务职级（新字段）
    zhicheng: this.formData.zhicheng, // 职称（新字段）
    // ... 其他字段
}
```

## 数据流向

### 新增/编辑流程
1. **前端** → 用户在页面输入"职务职级"和"职称"
2. **前端 → 后端** → 通过 `TpPersonBasicinfoVO` 传递 `zwzj` 和 `zhicheng`
3. **后端服务层** → `UserPersonServiceImpl.add()` 方法保存到 `tp_person_exinfo` 表
4. **数据库** → `ZWZJ` 和 `ZHICHENG` 字段

### 查看流程
1. **数据库** → 从 `tp_person_exinfo` 表读取 `ZWZJ` 和 `ZHICHENG`
2. **后端 → 前端** → 通过 `TpPersonExinfoVO` 返回 `zwzj` 和 `zhicheng`
3. **前端** → 页面显示"职务职级"和"职称"

## 字段废弃说明

### 前端废弃字段
- ❌ `office` - 职位（基本信息表）
- ❌ `titleCode` - 职称编码/文本（扩展信息表）

### 前端新字段
- ✅ `zwzj` - 职务职级（扩展信息表）
- ✅ `zhicheng` - 职称（扩展信息表）

### 注意事项
1. 旧字段在前端已注释，但未完全删除，以便回滚
2. 后端 `TpPersonBasicinfoVO` 已包含 `zwzj` 和 `zhicheng` 字段
3. 所有字段都是文本类型，用户可自由输入，不受字典限制

## 验证测试点

### 1. 新增人员
- [ ] 政府人员新增页面显示"职务职级"和"职称"输入框
- [ ] 企业人员新增页面显示"职务职级"和"职称"输入框
- [ ] 输入数据后保存成功
- [ ] 数据库 `tp_person_exinfo` 表正确保存 `ZWZJ` 和 `ZHICHENG`

### 2. 查看人员信息
- [ ] 个人信息页面正确显示"职务职级"和"职称"
- [ ] 数据从 `zwzj` 和 `zhicheng` 字段读取

### 3. 编辑人员信息
- [ ] 个人信息编辑页面显示"职务职级"和"职称"输入框
- [ ] 回显数据正确
- [ ] 修改后保存成功
- [ ] 数据库正确更新

### 4. 导入导出
- [ ] Excel模板包含"职务职级"和"职称"列
- [ ] 导入时正确解析并保存
- [ ] 导出时正确显示

## 修改文件清单

| 序号 | 文件路径 | 修改类型 | 说明 |
|------|----------|----------|------|
| 1 | `ps-fe/@fb/admin-base/views\sys\person\org\add-basicinfo.vue` | 修改 | 隐藏职位字段，保留职务职级和职称 |
| 2 | `ps-fe/@fb/admin-base/views\sys\person\ent\add-basicinfo.vue` | 修改 | 隐藏职位字段，保留职务职级和职称 |
| 3 | `ps-fe/@fb/admin-base/views\sys\user-home\profile.vue` | 修改 | 显示职务职级和职称，不再显示职位 |
| 4 | `ps-fe/@fb/admin-base/views\sys\user-home\profile_edit.vue` | 修改 | 编辑职务职级和职称，不再编辑职位 |

## 部署步骤

### 1. 确认数据库已升级
确保已执行数据库脚本 `add_zwzj_zhicheng_fields.sql`，添加了 `ZWZJ` 和 `ZHICHENG` 字段。

### 2. 重新构建前端
```bash
cd d:\projects\ps\ps-fe
npm run build
```

### 3. 部署前端资源
将构建好的前端资源部署到服务器。

### 4. 清理浏览器缓存
提醒用户清理浏览器缓存，或使用 `Ctrl+F5` 强制刷新。

## 总结

本次补充修改完成了以下工作：
1. ✅ 隐藏所有页面的"职位"（office）字段
2. ✅ 统一使用"职务职级"（zwzj）和"职称"（zhicheng）字段
3. ✅ 个人信息页面和编辑页面都已更新
4. ✅ 所有前端代码编译通过，无错误
5. ✅ 数据流向清晰，前后端字段映射正确

现在整个系统已完全迁移到新字段体系，旧字段已废弃但保留（用于数据兼容和回滚）。

---

**文档作者**：AI Assistant  
**创建时间**：2025-11-28  
**版本**：v1.1（补充修改）

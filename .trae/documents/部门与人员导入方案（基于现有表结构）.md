## 变更目标
- 部门层级仅支持分隔符 '>'。
- 为便于检索与展示，新增部门全路径字段 `FULL_DEPT_CODE`、`FULL_DEPT_NAME`。
- 部门“协办人”新增简单文本字段 `ASSISTANT_NOTE`。
- 人员新增“状态（在职/离职）”字段 `EMP_STATUS`；导入层不再写 `EXTEND01..03`。
- 坚持开闭原则：仅加字段与导入层逻辑，尽量不改既有功能；为避免影响现有接口，采用“写入新字段+兼容读取”的策略。

## 数据库变更
### 表 `tp_dept_basicinfo`
- 新增：
  - `FULL_DEPT_CODE` VARCHAR(500) NOT NULL DEFAULT ''（用层级编码/编号/ID拼接的部门路径码）
  - `FULL_DEPT_NAME` VARCHAR(500) NOT NULL DEFAULT ''（'>' 拼接的部门全名路径）
  - `ASSISTANT_NOTE` VARCHAR(500) NULL（协办人简单文本）
- 索引：
  - `IDX_FULL_DEPT_CODE`（`FULL_DEPT_CODE`）
  - `IDX_FULL_DEPT_NAME`（`FULL_DEPT_NAME`）
- 回填策略：
  - 以 `PDEPT_ID` 向上追溯，按 '>' 拼接 `DEPT_FULL_NAME` 得到 `FULL_DEPT_NAME`。
  - `FULL_DEPT_CODE` 推荐优先使用 `DEPT_NO` 路径；如缺失，退化为 `DEPT_ID` 路径或 `DEPT_LEVELCODE`。
  - 根节点哨兵 `1111111111111111111` 不参与拼接。

### 表 `tp_person_basicinfo`
- 新增：
  - `EMP_STATUS` VARCHAR(20) NOT NULL DEFAULT '在职'（枚举值：'在职'、'离职'；也可与字典码联动）
- 约束与联动：
  - 导入层将 `EMP_STATUS` 与 `ACTIVED` 联动：'在职'→`ACTIVED=1`，'离职'→`ACTIVED=0`（不强制数据库触发器，控制在服务层）。
- 停用写入：
  - 导入流程不再向 `EXTEND01..03` 写数据；保留兼容读取（如旧接口仍使用时），后续再分步迁移到语义化字段或 `tp_person_exinfo`。

## 应用层改动
- 实体与Mapper：
  - `DepartmentPO` 增加 `fullDeptCode/fullDeptName/assistantNote` 字段；对应 XML 增加插入/更新/查询列（参考现有 `TpDeptBasicinfoMapper.xml:126-136` 的字段列表与写法）。
  - `UserPO` 增加 `empStatus` 字段；`TpPersonBasicinfoMapper.xml` 插入/更新/查询语句添加该列（参考 `TpPersonBasicinfoMapper.xml:100-109, 170-206`）。
- 路径字段维护：
  - 新增/变更部门时，服务层在持久化前或后重建 `FULL_DEPT_CODE/FULL_DEPT_NAME`（沿父链递归或基于一次性查询构建字典）。
- 兼容性：
  - 现有查询若依赖 `DEPT_LEVELCODE/DEPT_FULL_NAME` 保持不变；新检索可使用 `FULL_DEPT_*` 提升体验与性能（可选增加 LIKE 或前缀匹配）。

## 导入适配
- 部门导入：
  - 仅支持 '>' 分隔；逐级 upsert（查重：优先 `DEPT_LEVELCODE`/`DEPT_NO`+父ID；保底 `DEPT_FULL_NAME` 同层级唯一）。
  - 显示顺序：同层级最小值+1。
  - 编号：按系统参数 `dept.no.auto.enabled` 自动生成；缺失则置空。
  - 协办人：写入 `ASSISTANT_NOTE`；无需结构化绑定。
  - 路径字段：导入完成后计算并写入 `FULL_DEPT_CODE/FULL_DEPT_NAME`。
- 人员导入：
  - 状态（必填）：解析 '在职/离职' → 写 `EMP_STATUS`，并联动 `ACTIVED`；不写 `EXTEND01..03`。
  - 部门（必填）：建立 `tp_person_dept` 主部门 `DEFAULT_DEPT=1`；兼职部门支持多条关联。
  - 账号与登录信息：沿用 `tp_account`（`USERNAME/USERPWD/PHONE/EMAIL`），不改结构。

## 数据迁移与回滚
- 数据回填脚本：
  - 部门：全量构建并回填 `FULL_DEPT_CODE/FULL_DEPT_NAME`，幂等。
  - 人员：默认将在职人员标记 `EMP_STATUS='在职'`，离职人员按既有逻辑或运维清单批量设置。
- 回滚：
  - 可逐步移除新列或停用写入；保留原有列不动，降低风险。

## 验证计划
- 结构校验：`SHOW COLUMNS` 验证新增列与索引。
- 业务校验：小样本模板导入演练；对照失败 Excel/成功记录；树路径与检索验证。
- 性能校验：`FULL_DEPT_*` 上的前缀/LIKE 查询走索引情况评估。

## 待确认点
- `FULL_DEPT_CODE` 的优先拼接依据（`DEPT_NO` > `DEPT_ID` > `DEPT_LEVELCODE`），是否接受该降级策略。
- 人员状态枚举是否固定为中文值（'在职'/'离职'），是否需要字典码映射。
- 根部门哨兵的路径显示策略（是否在名称中显示根）。

## 分阶段任务
1. 冻结字段定义与索引方案
2. 编写数据回填与联动策略（服务层实现）
3. 更新实体与Mapper（部门/人员）
4. 更新导入适配层（层级解析、路径计算、状态联动）
5. 小样本联调与失败 Excel 回写
6. 文档与运维脚本交付
# 目标
- 按你的要求，不采信现有项目文档，直接使用最新账号 `root/$D8BZ8Qmav` 连接 `ps-bmp` 数据库，读取真实表结构；基于实际结构输出“部门导入”和“人员导入”的字段映射与实现方案（仅调研与方案，不编码）。

## 读取数据库结构（计划）
- 连接方式：Windows/PowerShell，使用 `mysql` 客户端或信息架构查询；避免交互输入与特殊字符冲突。
- 安全参数（PowerShell 字符串处理）：
  - 推荐：`mysql -h alilaoba.cn -P 13307 -u root --password='$D8BZ8Qmav' -e "SHOW DATABASES;"`
  - 如 `--password` 引号被客户端保留导致连接失败，可改用信息架构查询 + 设置环境变量（临时）：
    - `setx MYSQL_PWD $D8BZ8Qmav`（仅用于读取，完成后清除）
    - `mysql -h alilaoba.cn -P 13307 -u root -e "SHOW TABLES IN ps-bmp;"`
- 读取内容：
  - 全库表清单：`SHOW TABLES IN ps-bmp;`
  - 关键表创建语句：`SHOW CREATE TABLE ps-bmp.tp_dept_basicinfo;`，`tp_person_basicinfo`，`tp_person_dept`，`tp_person_exinfo`，`tp_account`
  - 信息架构：
    - 列：`SELECT table_name,column_name,data_type,is_nullable,column_default FROM information_schema.columns WHERE table_schema='ps-bmp' ORDER BY table_name,ordinal_position;`
    - 索引：`SELECT table_name,index_name,column_name,non_unique FROM information_schema.statistics WHERE table_schema='ps-bmp' ORDER BY table_name,index_name,seq_in_index;`
- 异常处理：
  - 若出现 1045/主机名为 `Hiwifi.lan` 的拒绝，需在库侧放开 `root@%` 或按实际来源主机授权；读取成功后立即删除 `MYSQL_PWD` 环境变量。

## 输出物（基于真实结构）
- 表结构摘要（字段/类型/约束/索引），特别关注：
  - 部门：层级/路径/编号/排序/备注/扩展位（是否有 `extend01..05`）
  - 人员：基本信息字段集合（姓名/手机/邮箱/性别/身份证/生日/办公地点/工号等）
  - 人员-部门：主部门/兼职部门标记（`DEFAULT_DEPT`）
  - 扩展信息：学历/政治面貌/职位/毕业院校等是否具备对应列（或扩展位）
  - 账号：`USERNAME/USERPWD/PHONE/ENABLED/LOCKED/EMAIL联动`（如通过 `tp_person_basicinfo.EMAIL`）

## 导入映射与规则（依据真实结构给出）
- 部门导入（模板：部门（必填，">"分隔）、显示顺序、编号、备注、协办人）：
  - 路径解析：逐段比对/创建 `dept`，维护 `pdept_id`；路径写入（如存在 `dept_levelcode`）；名称映射 `dept_full_name`，简称可选 `dept_simple_name`
  - 显示顺序：映射 `order_index`；缺省时取同层级最小值+1
  - 编号：映射 `dept_no`；未填时，按规则自动生成（实现于导入逻辑）
  - 备注：映射 `dept_desc`
  - 协办人：若无专字段，落至扩展位（如 `extend03`），支持“名称##主键/##personId”解析
- 人员导入（模板：详见清单，仅列关键）：
  - 基本信息→`tp_person_basicinfo`：姓名/邮箱/手机/电话/性别/办公地点/出生日期/工号/身份证等
  - 部门（必填）→`tp_person_dept`：定位 `DEPT_ID` 并写主部门（`DEFAULT_DEPT=1`）；其他上级/兼职部门写 `DEFAULT_DEPT=0`
  - 账号→`tp_account`：账号/登录手机号/登录邮箱/密码/启用锁定；Keycloak 同步留二期
  - 扩展→`tp_person_exinfo` 或扩展位：学历/学位/毕业院校/政治面貌等
  - 自定义/特殊格式：
    - 数字格式仅保留数值；check 字段统一布尔；关联“名称##主键”优先按主键解析

## 校验与失败行导出
- 唯一性：人员的手机号/邮箱/身份证/工号重复检查；部门的（名称+父ID+租户）唯一、编号冲突检查
- 日期与枚举：统一格式化；性别/状态转码
- 失败行：逐行收集，导出 Excel，包含失败原因与定位信息

## 编码接口草案（待你确认后执行）
- `test_import_department`：xlsx 上传，返回 `JsonResponse` 成功/失败行
- `test_import_person`：xlsx 上传，写入四表，返回 `JsonResponse`
- 均不修改既有功能；规则实现于导入服务层；扩展字段仅占用现有扩展位

## 分阶段任务清单
- 直接读取 `ps-bmp` 真实表结构（库侧授权若需）
- 完成部门导入字段映射与规则（顺序/编号/路径/协办人）
- 完成人员导入字段映射与规则（基本/账号/部门/扩展）
- 设计失败行收集与导出格式
- 输出测试接口规格（请求/响应/示例），待你批准后进入编码